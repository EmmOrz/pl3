<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åä¹Œåˆä¹‹ä¼— Â· æ’åˆ—ä¸‰ç»„é€‰6ç­–ç•¥ç”Ÿæˆå™¨</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        /* ========== åŸºç¡€é‡ç½®ä¸å…¨å±€å˜é‡ ========== */
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131a2b;
            --bg-tertiary: #1a2440;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #2d3a5c;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gradient-primary: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            --gradient-card: linear-gradient(145deg, #1e2a4a, #151d35);
            --shadow-glow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ========== å¸ƒå±€å®¹å™¨ ========== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 24px;
            margin-top: 24px;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* ========== å¤´éƒ¨åŒºåŸŸ ========== */
        header {
            text-align: center;
            padding: 40px 20px;
            background: var(--gradient-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
        }

        header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }

        header .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            letter-spacing: 2px;
        }

        header .badge {
            display: inline-block;
            margin-top: 16px;
            padding: 6px 16px;
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid var(--accent-purple);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--accent-purple);
        }

        /* ========== ä¸»å†…å®¹åŒº ========== */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* ========== å¡ç‰‡é€šç”¨æ ·å¼ ========== */
        .card {
            background: var(--gradient-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--accent-blue);
            box-shadow: var(--shadow-glow);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title .icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            border-radius: 8px;
            font-size: 1rem;
        }

        /* ========== ç­–ç•¥é€‰æ‹©å¡ç‰‡ ========== */
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        @media (max-width: 768px) {
            .strategy-grid {
                grid-template-columns: 1fr;
            }
        }

        .strategy-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .strategy-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .strategy-card.active {
            border-color: var(--accent-purple);
            background: rgba(139, 92, 246, 0.1);
        }

        .strategy-card.active::before {
            content: 'âœ“';
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            background: var(--accent-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
        }

        .strategy-card h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .strategy-card p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .strategy-card .tag {
            display: inline-block;
            margin-top: 12px;
            padding: 4px 10px;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 4px;
            font-size: 0.75rem;
            color: var(--accent-cyan);
        }

        /* ========== é«˜çº§é€‰é¡¹ ========== */
        .options-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 16px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            display: none;
        }

        .checkbox-item .checkmark {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
        }

        .checkbox-item input:checked + .checkmark {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
        }

        .checkbox-item input:checked + .checkmark::after {
            content: 'âœ“';
            color: white;
            font-size: 14px;
        }

        .checkbox-item span {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* ========== ç”ŸæˆæŒ‰é’® ========== */
        .generate-btn {
            width: 100%;
            padding: 18px 32px;
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.4);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .generate-btn.loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .generate-btn .spinner {
            display: none;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        .generate-btn.loading .spinner {
            display: inline-block;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========== ç»“æœå±•ç¤ºåŒº ========== */
        .results-section {
            display: none;
        }

        .results-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: flipIn 0.6s ease;
        }

        .result-card:nth-child(2) { animation-delay: 0.1s; }
        .result-card:nth-child(3) { animation-delay: 0.2s; }

        @keyframes flipIn {
            0% { transform: perspective(400px) rotateY(90deg); opacity: 0; }
            100% { transform: perspective(400px) rotateY(0); opacity: 1; }
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .result-card .label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .result-card .number {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .result-card .analysis {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: left;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
            line-height: 1.6;
        }

        .result-card .analysis .highlight {
            color: var(--accent-cyan);
            font-weight: 500;
        }

        /* ========== å¤§å¸ˆæ´å¯Ÿ ========== */
        .insight-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid var(--accent-purple);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .insight-box .quote {
            font-style: italic;
            color: var(--text-primary);
            font-size: 1rem;
            line-height: 1.6;
        }

        .insight-box .author {
            margin-top: 12px;
            color: var(--accent-purple);
            font-size: 0.85rem;
        }

        /* ========== ä¾§è¾¹æ  ========== */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar .card {
            padding: 20px;
        }

        /* ========== è¿‘æœŸå¼€å¥– ========== */
        .history-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 12px;
        }

        .history-list::-webkit-scrollbar {
            width: 6px;
        }

        .history-list::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            background: var(--bg-tertiary);
        }

        .history-item .num {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-cyan);
            letter-spacing: 4px;
        }

        .history-item .date {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .history-item .delete-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border-radius: 4px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .history-item:hover .delete-btn {
            opacity: 1;
        }

        .history-item .delete-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* ========== æ·»åŠ å·ç  ========== */
        .add-number-form {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .add-number-form input {
            flex: 1;
            padding: 10px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
            outline: none;
            transition: all 0.2s ease;
        }

        .add-number-form input:focus {
            border-color: var(--accent-blue);
        }

        .add-number-form input::placeholder {
            color: var(--text-muted);
        }

        .add-number-form button {
            padding: 10px 16px;
            background: var(--accent-blue);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-number-form button:hover {
            background: var(--accent-purple);
        }

        /* ========== çƒ­ç‚¹å·ç  ========== */
        .hotspot-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .hotspot-tag {
            padding: 6px 12px;
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 6px;
            font-size: 0.85rem;
            color: var(--danger);
            font-family: 'Monaco', 'Consolas', monospace;
        }

        /* ========== æ•°æ®åŠ è½½çŠ¶æ€ ========== */
        .loading-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading-state .spinner-large {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        /* ========== ç»Ÿè®¡ä¿¡æ¯ ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .stat-item {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-item .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .stat-item .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* ========== é¿å¼€æœŸæ•°é€‰æ‹© ========== */
        .avoid-period {
            margin-top: 16px;
        }

        .avoid-period label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .avoid-period select {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
            outline: none;
            cursor: pointer;
        }

        .avoid-period select:focus {
            border-color: var(--accent-blue);
        }

        /* ========== é”™è¯¯æç¤º ========== */
        .error-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: var(--danger);
            color: white;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: none;
        }

        .error-toast.show {
            display: block;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ========== åŸç†è¯´æ˜ ========== */
        .principle-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-top: 12px;
        }

        .principle-text strong {
            color: var(--accent-cyan);
        }

        /* ========== åˆ·æ–°æŒ‰é’® ========== */
        .refresh-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: auto;
        }

        .refresh-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-header .card-title {
            margin-bottom: 0;
        }

        /* ========== å®Œæ•´å¼€å¥–è®°å½•è¡¨æ ¼æ ·å¼ ========== */
        .full-table-section .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            max-width: 100%;
        }

        .full-history-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
        }

        .full-history-table th,
        .full-history-table td {
            padding: 12px;
            text-align: left;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .full-history-table th,
            .full-history-table td {
                padding: 10px;
                font-size: 0.82rem;
            }

            .full-table-section .table-container {
                max-height: 420px;
            }
        }

        /* æ›´å°å±å¹•ï¼šå°†è¡¨æ ¼è¡Œè½¬ä¸ºå¡ç‰‡å¼ï¼Œæå‡å¯è¯»æ€§ï¼ˆç§»åŠ¨ç«¯å‹å¥½ï¼‰ */
        @media (max-width: 480px) {
            .full-history-table thead { display: none; }
            .full-history-table, .full-history-table tbody, .full-history-table tr, .full-history-table td {
                display: block;
                width: 100%;
            }
            .full-history-table tr {
                margin-bottom: 12px;
                background: var(--bg-secondary);
                border-radius: 8px;
                padding: 10px;
            }
            .full-history-table td {
                white-space: normal;
                padding: 6px 10px;
                border: none;
                border-bottom: 1px solid rgba(255,255,255,0.03);
            }
            .full-history-table td .label {
                color: var(--text-muted);
                display: inline-block;
                width: 35%;
                font-size: 0.78rem;
            }
        }

        .load-more {
            padding: 10px 16px;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
        }

        .load-more:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- é”™è¯¯æç¤º -->
    <div class="error-toast" id="errorToast"></div>

    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header>
            <h1>åä¹Œåˆä¹‹ä¼— Â· æ’åˆ—ä¸‰ç»„é€‰6ç­–ç•¥ç”Ÿæˆå™¨</h1>
            <p class="subtitle">ç”¨æ•°å­¦é¿å¼€äººç¾¤ï¼Œç”¨ç†æ€§èµ¢å¾—ä½“éªŒ</p>
            <span class="badge">åŸºäºè¡Œä¸ºé‡‘èå­¦ä¸åšå¼ˆè®º</span>
        </header>

        <!-- ä¸»ä»ªè¡¨ç›˜ -->
        <div class="dashboard">
            <!-- ä¸»å†…å®¹åŒº -->
            <main class="main-content">
                <!-- ç­–ç•¥é€‰æ‹© -->
                <section class="card">
                    <h2 class="card-title">
                        <span class="icon">âš¡</span>
                        é€‰æ‹©ç­–ç•¥å¼•æ“
                    </h2>
                    <div class="strategy-grid">
                        <div class="strategy-card active" data-strategy="math">
                            <h3>æ•°å­¦å‡åŒ€åˆ†å¸ƒ</h3>
                            <p>åŸºäºå’Œå€¼ã€è·¨åº¦ã€å¥‡å¶æ¯”ã€å¤§å°æ¯”å››ç»´å‡åŒ€åˆ†å¸ƒï¼Œç”Ÿæˆå½¼æ­¤å·®å¼‚åŒ–çš„å·ç ç»„åˆã€‚</p>
                            <span class="tag">æ¨è Â· ç†æ€§æ´¾</span>
                        </div>
                        <div class="strategy-card" data-strategy="culture">
                            <h3>æ–‡åŒ–é¿å¼€ç­–ç•¥</h3>
                            <p>ä¸»åŠ¨é¿å¼€å‰åˆ©æ•°å­—6ã€8ã€9ï¼Œä¼˜å…ˆä½¿ç”¨0ã€2ã€5ã€7ç­‰"ä¸­æ€§"æ•°å­—ï¼Œç”Ÿæˆè§†è§‰ä¸Š"ä¸ç¾è§‚"çš„ç»„åˆã€‚</p>
                            <span class="tag">åç›´è§‰æ´¾</span>
                        </div>
                        <div class="strategy-card" data-strategy="cold">
                            <h3>å†·åƒ»è¶‹åŠ¿ç­–ç•¥</h3>
                            <p>æ·±åº¦åˆ†æè¿‘æœŸå¼€å¥–ï¼Œæœ€å¤§ç¨‹åº¦é¿å¼€çƒ­å·ï¼Œé€‰æ‹©å‡ºç°é¢‘ç‡æœ€ä½çš„æ•°å­—ç»„åˆã€‚</p>
                            <span class="tag">æ•°æ®æ´¾</span>
                        </div>
                        <div class="strategy-card" data-strategy="hot">
                            <h3>è¿½çƒ­é¿å†·ç­–ç•¥</h3>
                            <p>é¡ºåŠ¿è€Œä¸ºï¼Œå°†è¿‘æœŸçƒ­ç ä½œä¸ºæ ¸å¿ƒï¼Œç»„åˆç”Ÿæˆå·ç ï¼Œç¡®ä¿å’Œå€¼è½åœ¨çƒ­åŒºã€‚</p>
                            <span class="tag">è¶‹åŠ¿æ´¾</span>
                        </div>
                        <div class="strategy-card" data-strategy="coldreturn">
                            <h3>èµŒå†·å›å½’ç­–ç•¥</h3>
                            <p>åŸºäºæ¦‚ç‡å¹³å‡å¾‹ï¼Œé€‰ç”¨é•¿æœŸé—æ¼çš„å†·ç ï¼Œæ­é…ä¸­æ€§ç ç»„åˆã€‚</p>
                            <span class="tag">é€†åŠ¿åšå¼ˆ</span>
                        </div>
                        <div class="strategy-card" data-strategy="precision">
                            <h3>ç²¾ç¡®é€†å‘ç­–ç•¥</h3>
                            <p>é¿å¼€å¯¼è‡´ç»„é€‰6å¥–é‡‘æœ€ä½çš„"å¤§ä¼—å·"ï¼Œç›´æ¥ä¸å¤§ä¼—èµ„é‡‘å¯¹èµŒã€‚</p>
                            <span class="tag">èµ„é‡‘åšå¼ˆæ´¾</span>
                        </div>
                    </div>

                    <!-- åˆ†ææœŸæ•°é€‰æ‹© -->
                    <div class="options-row" style="margin-top: 20px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 8px;">åˆ†ææœŸæ•°ï¼š</label>
                            <select id="analysisPeriods" style="width: 100%; padding: 10px 14px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 0.95rem; outline: none; cursor: pointer;">
                                <option value="10">æœ€è¿‘ 10 æœŸ</option>
                                <option value="30" selected>æœ€è¿‘ 30 æœŸ</option>
                                <option value="50">æœ€è¿‘ 50 æœŸ</option>
                                <option value="100">æœ€è¿‘ 100 æœŸ</option>
                                <option value="200">æœ€è¿‘ 200 æœŸ</option>
                                <option value="500">æœ€è¿‘ 500 æœŸ</option>
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 8px;">é¿å¼€æœ€è¿‘ N æœŸå¼€å¥–å·ç ï¼š</label>
                            <select id="avoidPeriods" style="width: 100%; padding: 10px 14px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 0.95rem; outline: none; cursor: pointer;">
                                <option value="5">æœ€è¿‘ 5 æœŸ</option>
                                <option value="10" selected>æœ€è¿‘ 10 æœŸ</option>
                                <option value="15">æœ€è¿‘ 15 æœŸ</option>
                                <option value="20">æœ€è¿‘ 20 æœŸ</option>
                                <option value="30">æœ€è¿‘ 30 æœŸ</option>
                            </select>
                        </div>
                    </div>

                    <!-- é«˜çº§é€‰é¡¹ -->
                    <div class="options-row">
                        <label class="checkbox-item">
                            <input type="checkbox" id="strictMode">
                            <span class="checkmark"></span>
                            <span>ã€ä¸¥æ ¼æ¨¡å¼ã€‘å¼ºåˆ¶é¿å¼€æ‰€æœ‰è¿‘æœŸå·ç æ•°å­—</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="aggressiveMode">
                            <span class="checkmark"></span>
                            <span>ã€æ¿€è¿›æ¨¡å¼ã€‘å…è®¸åŒ…å«ä¸€ä¸ª"4"</span>
                        </label>
                    </div>
                </section>

                <!-- ç”ŸæˆæŒ‰é’® -->
                <button class="generate-btn" id="generateBtn">
                    <span class="spinner"></span>
                    ç”Ÿæˆæˆ‘çš„ä¸‰æ³¨ç­–ç•¥å·ç 
                </button>

                <!-- ç»“æœå±•ç¤ºåŒº -->
                <section class="results-section" id="resultsSection">
                    <div class="card">
                        <h2 class="card-title">
                            <span class="icon">ğŸ¯</span>
                            ç­–ç•¥ç”Ÿæˆç»“æœ
                        </h2>
                        <div class="results-grid" id="resultsGrid">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- å¤§å¸ˆæ´å¯Ÿ -->
                        <div class="insight-box">
                            <p class="quote" id="insightQuote">"å¤§ä¼—è¿½é€è§„å¾‹ï¼Œè€ŒçœŸæ­£çš„éšæœºæ€§å¾€å¾€é¢ç›®å¯æ†ã€‚"</p>
                            <p class="author">â€” åä¹Œåˆä¹‹ä¼—ç­–ç•¥ç³»ç»Ÿ</p>
                        </div>
                    </div>
                </section>
            </main>

            <!-- ä¾§è¾¹æ  -->
            <aside class="sidebar">
                <!-- è¿‘æœŸå¼€å¥– -->
                <article class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <span class="icon">ğŸ“Š</span>
                            è¿‘æœŸå¼€å¥–è®°å½•
                        </h3>
                        <button class="refresh-btn" id="refreshBtn">åˆ·æ–°æ•°æ®</button>
                        <button class="refresh-btn" id="exportBtn">ä¿å­˜ä¸ºå•æ–‡ä»¶</button>
                    </div>
                    <div class="history-list" id="historyList">
                        <div class="loading-state">
                            <div class="spinner-large"></div>
                            <p>æ­£åœ¨è·å–å¼€å¥–æ•°æ®...</p>
                        </div>
                    </div>

                    
                    <div class="add-number-form">
                        <input type="text" id="newNumber" placeholder="æ‰‹åŠ¨æ·»åŠ å·ç  (å¦‚: 123)" maxlength="3">
                        <button id="addNumberBtn">æ·»åŠ </button>
                    </div>
                </article>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <article class="card">
                    <h3 class="card-title">
                        <span class="icon">ğŸ“ˆ</span>
                        æ•°å­—çƒ­åº¦åˆ†æ
                    </h3>
                    <div class="stats-grid" id="statsGrid">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </article>

                <!-- çƒ­ç‚¹å·ç  -->
                <article class="card">
                    <h3 class="card-title">
                        <span class="icon">ğŸš«</span>
                        åº”é¿å¼€çš„çƒ­ç‚¹å·ç 
                    </h3>
                    <div class="hotspot-grid" id="hotspotGrid">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </article>

                <!-- ç­–ç•¥åŸç† -->
                <article class="card">
                    <h3 class="card-title">
                        <span class="icon">ğŸ’¡</span>
                        ç­–ç•¥åŸç†
                    </h3>
                    <p class="principle-text">
                        æœ¬ç”Ÿæˆå™¨åŸºäº<strong>è¡Œä¸ºé‡‘èå­¦</strong>ä¸<strong>åšå¼ˆè®º</strong>è®¾è®¡ã€‚æ ¸å¿ƒç†å¿µï¼šå½“å¤šæ•°äººé€‰æ‹©ç›¸åŒå·ç æ—¶ï¼Œå³ä½¿ä¸­å¥–ä¹Ÿéœ€åˆ†æ‘Šå¥–é‡‘ã€‚
                        <br><br>
                        æˆ‘ä»¬é€šè¿‡<strong>é¿å¼€é”®ç›˜ç»„åˆ</strong>ï¼ˆ123ã€456ç­‰ï¼‰ã€<strong>å‰åˆ©æ•°å­—</strong>ï¼ˆ666ã€888ç­‰ï¼‰ã€<strong>ç”Ÿæ—¥ç›¸å…³</strong>ï¼ˆ01-31ï¼‰ä»¥åŠ<strong>è¿‘æœŸçƒ­å·</strong>ï¼Œ
                        å¸®åŠ©æ‚¨æ‰¾åˆ°è¢«å¤§ä¼—å¿½è§†çš„"å†·é—¨"ç»„åˆã€‚
                        <br><br>
                        <strong>è®°ä½ï¼š</strong>è¿™ä¸æ˜¯é¢„æµ‹å·¥å…·ï¼Œè€Œæ˜¯å·®å¼‚åŒ–é€‰æ‹©å·¥å…·ã€‚
                    </p>
                </article>
            </aside>
        </div>

        <!-- æ•°æ®åˆ†æåŒºåŸŸ -->
        <section class="card" id="analysisSection" style="margin-top: 24px; display: none;">
            <h2 class="card-title">
                <span class="icon">ğŸ“Š</span>
                æ•°æ®åˆ†ææŠ¥å‘Š
            </h2>
            <div id="analysisContent" style="margin-top: 20px;">
                <!-- åŠ¨æ€ç”Ÿæˆæ•°æ®åˆ†æè¡¨æ ¼ -->
            </div>
        </section>

        <!-- å®Œæ•´å¼€å¥–è®°å½•è¡¨æ ¼ï¼ˆåˆ†é¡µ / æ— é™åŠ è½½ï¼‰ -->
        <section class="card full-table-section" id="fullTableSection" style="margin-top: 24px;">
            <h2 class="card-title">
                <span class="icon">ğŸ“š</span>
                å®Œæ•´å¼€å¥–è®°å½•ï¼ˆè¿‘500æœŸï¼‰
            </h2>
            <div class="table-container" id="fullTableContainer" style="max-height: 420px; overflow-y: auto;">
                <table class="full-history-table" id="fullHistoryTable">
                    <thead>
                        <tr>
                            <th>æœŸå·</th>
                            <th>æ—¥æœŸ</th>
                            <th>å·ç </th>
                            <th>ç›´é€‰ æ³¨æ•°</th>
                            <th>ç›´é€‰ å¥–é‡‘</th>
                            <th>ç»„é€‰3 æ³¨æ•°</th>
                            <th>ç»„é€‰3 å¥–é‡‘</th>
                            <th>ç»„é€‰6 æ³¨æ•°</th>
                            <th>ç»„é€‰6 å¥–é‡‘</th>
                            <th>é”€å”®é¢</th>
                            <th>å…¬å‘Š</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div style="display:flex; justify-content:center; margin-top:12px;">
                <button class="load-more" id="loadMoreBtn">åŠ è½½æ›´å¤š</button>
            </div>
        </section>
    </div>

    <script>
        /**
         * ========================================
         * åä¹Œåˆä¹‹ä¼— Â· æ’åˆ—ä¸‰ç»„é€‰6ç­–ç•¥ç”Ÿæˆå™¨
         * æ ¸å¿ƒç®—æ³•ä¸äº¤äº’é€»è¾‘
         * ========================================
         */

        // ========== å…¨å±€é…ç½®ä¸æ•°æ® ==========
        const CONFIG = {
            // API é…ç½®
            API_URL: 'https://webapi.sporttery.cn/gateway/lottery/getHistoryPageListV1.qry?gameNo=35&provinceId=0&pageSize=100&isVerify=1&pageNo=1&termLimits=100',

            // ä»£ç†é…ç½®ï¼ˆå½“æµè§ˆå™¨ç›´æ¥è¯·æ±‚è¢«æ‹¦æˆªæ—¶ä¼šå°è¯•è¿™äº›ä»£ç†ï¼Œæ¨èéƒ¨ç½² Cloudflare Worker å¹¶æŠŠ URL å¡«åˆ°ä¸‹é¢ï¼‰
            PROXY_ENDPOINT: '', // ç¤ºä¾‹: 'https://your-worker.example/fetch?url='
            PROXY_AUTO_TRY: true, // è‡ªåŠ¨åœ¨è¯·æ±‚å¤±è´¥æ—¶å°è¯•ä»£ç†
            // ç”¨äºæ¨¡æ‹Ÿ curl çš„å¤´ï¼ˆæ³¨æ„ï¼šæµè§ˆå™¨ä¸å…è®¸éšæ„è®¾ç½® Referer/Originï¼Œéœ€é€šè¿‡æœåŠ¡å™¨ç«¯ä»£ç†è®¾ç½®ï¼‰
            PROXY_DEFAULT_REFERER: 'https://webapi.sporttery.cn/',
            PROXY_DEFAULT_ORIGIN: 'https://webapi.sporttery.cn' ,


            // çƒ­ç‚¹å·ç åº“ï¼ˆå¤§ä¼—é«˜é¢‘é€‰æ‹©ï¼‰
            HOTSPOT_NUMBERS: [
                // é”®ç›˜ç»„åˆ
                '123', '234', '345', '456', '567', '678', '789',
                '321', '432', '543', '654', '765', '876', '987',
                '147', '258', '369', '741', '852', '963',
                '159', '357', '753', '951',
                '123', '456', '789',
                // å‰åˆ©æ•°å­—ç»„åˆ
                '666', '888', '999', '168', '268', '368', '518', '618', '688', '818', '868', '886', '888',
                '066', '088', '068', '086', '006', '008',
                '116', '118', '166', '188', '668', '698', '689', '896', '869',
                // é¡ºå­ä¸è±¹å­
                '000', '111', '222', '333', '444', '555', '777',
                '012', '890',
                // ç”Ÿæ—¥ç›¸å…³é«˜é¢‘ï¼ˆæœˆä»½01-12ï¼Œæ—¥æœŸ01-31çš„å¸¸è§ç»„åˆï¼‰
                '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112',
                '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212',
                '301', '302', '303', '304', '305', '306', '307', '308', '309', '310', '311', '312',
                '120', '121', '122', '123', '124', '125', '126', '127', '128', '129', '130', '131',
                '520', '521', '502', '512', // ç½‘ç»œæµè¡Œ
                '214', '314', '514', '714', '914', // æƒ…äººèŠ‚ç›¸å…³
            ],

            // å¤§å¸ˆæ´å¯Ÿè¯­å½•
            INSIGHTS: [
                "å¤§ä¼—è¿½é€è§„å¾‹ï¼Œè€ŒçœŸæ­£çš„éšæœºæ€§å¾€å¾€é¢ç›®å¯æ†ã€‚",
                "ä½ é¿å¼€çš„ä¸æ˜¯æ•°å­—ï¼Œæ˜¯äººç¾¤çš„éç†æ€§å…±è¯†ã€‚",
                "åœ¨æ¦‚ç‡é¢å‰ï¼Œæ‰€æœ‰æ•°å­—ç”Ÿè€Œå¹³ç­‰ï¼Œä½†é€‰æ‹©è€…å´å¹¶éå¦‚æ­¤ã€‚",
                "èªæ˜çš„ç­–ç•¥ä¸æ˜¯é¢„æµ‹ä¸­å¥–å·ç ï¼Œè€Œæ˜¯é¿å¼€æ‹¥æŒ¤çš„é€‰æ‹©ã€‚",
                "å½“æ‰€æœ‰äººéƒ½åœ¨è¿½é€å¹¸è¿æ•°å­—æ—¶ï¼Œä½ é€‰æ‹©äº†æ•°å­¦ã€‚",
                "åšå¼ˆè®ºå‘Šè¯‰æˆ‘ä»¬ï¼šæœ€ä¼˜ç­–ç•¥å¾€å¾€æ˜¯åç›´è§‰çš„ã€‚",
                "ç‹¬ç«‹æ€è€ƒçš„ä»£ä»·æ˜¯å­¤ç‹¬ï¼Œä½†å›æŠ¥æ˜¯å·®å¼‚åŒ–çš„å¯èƒ½ã€‚",
                "ç»Ÿè®¡å­¦å®¶ä¸ä¿¡å‘½è¿ï¼Œä»–ä»¬ç›¸ä¿¡åˆ†å¸ƒã€‚",
                "é¿å¼€äººç¾¤ï¼Œä¸æ˜¯ä¸ºäº†ç‰¹ç«‹ç‹¬è¡Œï¼Œè€Œæ˜¯ä¸ºäº†æ•°å­¦æ•ˆç‡ã€‚",
                "æ¯ä¸€ä¸ªçƒ­é—¨å·ç èƒŒåï¼Œéƒ½æœ‰æ— æ•°äººåœ¨åˆ†æ‘ŠæœŸæœ›å€¼ã€‚"
            ]
        };

        // å…¨å±€çŠ¶æ€
        let state = {
            historyNumbers: [],      // è¿‘æœŸå¼€å¥–å·ç 
            selectedStrategy: 'math', // å½“å‰ç­–ç•¥
            isLoading: false
        };

        // ========== å·¥å…·å‡½æ•° ==========

        /**
         * æ˜¾ç¤ºé”™è¯¯æç¤º
         */
        function showError(message) {
            const toast = $('#errorToast');
            toast.text(message).addClass('show');
            setTimeout(() => toast.removeClass('show'), 3000);
        }

        /**
         * è§£æå·ç ä¸ºæ•°ç»„
         */
        function parseNumber(num) {
            return num.toString().padStart(3, '0').split('').map(Number);
        }

        /**
         * è®¡ç®—ç»„é€‰6çš„æ’åºå½¢å¼ï¼ˆå‡åºï¼‰
         */
        function sortNumber(num) {
            return parseNumber(num).sort((a, b) => a - b).join('');
        }

        /**
         * åˆ¤æ–­æ˜¯å¦ä¸ºç»„é€‰6ï¼ˆä¸‰ä¸ªæ•°å­—éƒ½ä¸åŒï¼‰
         */
        function isZuxuan6(num) {
            const digits = parseNumber(num);
            return new Set(digits).size === 3;
        }

        /**
         * è®¡ç®—å’Œå€¼
         */
        function calcSum(num) {
            return parseNumber(num).reduce((a, b) => a + b, 0);
        }

        /**
         * è®¡ç®—è·¨åº¦
         */
        function calcSpan(num) {
            const digits = parseNumber(num);
            return Math.max(...digits) - Math.min(...digits);
        }

        /**
         * è®¡ç®—å¥‡å¶æ¯”
         */
        function calcOddEven(num) {
            const digits = parseNumber(num);
            const odd = digits.filter(d => d % 2 === 1).length;
            return `${odd}:${3 - odd}`;
        }

        /**
         * è®¡ç®—å¤§å°æ¯”ï¼ˆ5-9ä¸ºå¤§ï¼Œ0-4ä¸ºå°ï¼‰
         */
        function calcBigSmall(num) {
            const digits = parseNumber(num);
            const big = digits.filter(d => d >= 5).length;
            return `${big}:${3 - big}`;
        }

        /**
         * æ£€æŸ¥æ˜¯å¦ä¸ºç­‰å·®æ•°åˆ—
         */
        function isArithmeticSequence(num) {
            const digits = parseNumber(num).sort((a, b) => a - b);
            return (digits[1] - digits[0]) === (digits[2] - digits[1]);
        }

        /**
         * æ£€æŸ¥æ˜¯å¦åŒ…å«çƒ­ç‚¹ç»„åˆ
         */
        function isHotspot(num) {
            const sorted = sortNumber(num);
            return CONFIG.HOTSPOT_NUMBERS.some(hot => sortNumber(hot) === sorted);
        }

        /**
         * è·å–è¿‘æœŸå·ç ä¸­å„æ•°å­—å‡ºç°é¢‘ç‡
         */
        function getDigitFrequency(historyList, limit) {
            const freq = Array(10).fill(0);
            const limitedList = historyList.slice(0, limit);
            limitedList.forEach(item => {
                parseNumber(item.number).forEach(d => freq[d]++);
            });
            return freq;
        }

        // ========== API æ•°æ®è·å– ==========

        /**
         * ä»å®˜æ–¹APIè·å–æŒ‡å®šé¡µæ•°çš„å¼€å¥–æ•°æ®
         */


        /**
         * ä»å®˜æ–¹APIè·å–è¿‘æœŸå¼€å¥–æ•°æ®ï¼ˆæ”¯æŒåˆ†é¡µè·å–å¤šæœŸï¼‰
         */
        async function fetchHistoryData(totalPages = 2, pageSize = 30) {
            // å‡å°‘è¯·æ±‚é¡µæ•°å’Œæ¯é¡µæ•°æ®é‡ï¼Œé™ä½æœåŠ¡å™¨å‹åŠ›
            state.isLoading = true;
            $('#historyList').html('<div class="loading-state"><div class="spinner-large"></div><p>æ­£åœ¨è·å–å¼€å¥–æ•°æ®...</p></div>');

            // å¦‚æœå‹¾é€‰äº†â€œä½¿ç”¨å†…ç½®æ•°æ®â€ï¼Œæˆ–å­˜åœ¨æœ¬åœ°å­˜å‚¨æ•°æ®ï¼Œä¼˜å…ˆä½¿ç”¨æœ¬åœ°/å†…ç½®æ•°æ®
            const useLocal = $('#useLocalData').length && $('#useLocalData').is(':checked');
            // å¦‚æœé¡µé¢å†…åµŒäº† PRELOADED_HISTORYï¼ˆä¾‹å¦‚ï¼šç”¨æˆ·ç”Ÿæˆçš„å•æ–‡ä»¶ HTMLï¼‰ï¼Œä¼˜å…ˆä½¿ç”¨å®ƒä»¥æ”¯æŒç¦»çº¿è®¿é—®
            if (window.PRELOADED_HISTORY && Array.isArray(window.PRELOADED_HISTORY) && window.PRELOADED_HISTORY.length) {
                state.historyNumbers = JSON.parse(JSON.stringify(window.PRELOADED_HISTORY)).sort((a, b) => parseInt(b.period || 0) - parseInt(a.period || 0));
                state.isLoading = false;
                $('#historyList').html('');
                renderHistoryList();
                renderStats();
                setupFullHistoryTable();
                return true;
            }

                // ä¼˜å…ˆä½¿ç”¨ localStorage ä¸­çš„ç¼“å­˜ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œä¾¿äºæœ¬åœ°è¦†ç›–é¡µé¢åæ— éœ€é‡å¤ç²˜è´´
                try {
                    const stored = localStorage.getItem('anti_crowd_history');
                    if (stored) {
                        const parsedStored = JSON.parse(stored);
                        if (Array.isArray(parsedStored) && parsedStored.length) {
                            state.historyNumbers = parsedStored.sort((a, b) => parseInt(b.period || 0) - parseInt(a.period || 0));
                            state.isLoading = false;
                            $('#historyList').html('');
                            renderHistoryList();
                            renderStats();
                            setupFullHistoryTable();
                            return true;
                        }
                    }
                } catch (e) {
                    console.warn('è¯»å– localStorage å¤±è´¥', e);
                }

            // ä½¿ç”¨ fetch è·å–å•é¡µå¹¶æ ‡å‡†åŒ–è¿”å›
            // é€šè¿‡ä»£ç†åˆ—è¡¨å°è¯•æ‹‰å–å¹¶è¿”å›è§£æåçš„ JSONï¼ˆæ”¯æŒå¯èƒ½è¢« JSONP åŒ…è£¹çš„æƒ…å†µï¼‰
            async function fetchJsonThroughProxy(proxies, target) {
                let lastErr = null;
                for (const p of proxies) {
                    try {
                        const prefix = p;
                        const url = prefix.indexOf('{url}') !== -1 ? prefix.replace('{url}', encodeURIComponent(target)) : prefix + encodeURIComponent(target);
                        const resp = await fetch(url, { method: 'GET' });
                        if (!resp.ok) throw new Error('http:' + resp.status);
                        let data = null;
                        try { data = await resp.json(); }
                        catch (ee) {
                            const text = await resp.text();
                            const maybe = text.replace(/^[^(]*\((([\s\S]*)?)\);?$/, '$1');
                            data = JSON.parse(maybe);
                        }
                        return data;
                    } catch (err) {
                        lastErr = err;
                        console.warn('proxy fetch failed', p, err);
                        continue;
                    }
                }
                throw lastErr || new Error('proxy_failed');
            }

            async function fetchHistoryPageRuntime(pageNo, pageSize) {
                const url = (CONFIG.API_URL || '').replace(/pageNo=\d+/, 'pageNo=' + pageNo).replace(/pageSize=\d+/, 'pageSize=' + pageSize);
                const target = url.replace(/callback=\?/, '');

                // ä¼˜å…ˆå°è¯•ç”¨æˆ·é…ç½®çš„ä»£ç†ï¼ˆå¯ç”± Cloudflare Worker ç­‰è®¾ç½® Referer/Originï¼Œå¹¶è¿”å› CORS å…è®¸ï¼‰
                if (CONFIG.PROXY_ENDPOINT && CONFIG.PROXY_AUTO_TRY) {
                    try {
                        const data = await fetchJsonThroughProxy([CONFIG.PROXY_ENDPOINT], target);
                        let list = null;
                        if (Array.isArray(data)) list = data;
                        else if (data.value && Array.isArray(data.value.list)) list = data.value.list;
                        else if (Array.isArray(data.list)) list = data.list;
                        else if (data.data && Array.isArray(data.data.list)) list = data.data.list;
                        else throw new Error('no_list_in_response');
                        return list.map(normalizeApiItem).filter(i => i && i.period && i.number);
                    } catch (e) {
                        console.warn('configured proxy fetch failed', e);
                        // ç»§ç»­å°è¯•ç›´æ¥è¯·æ±‚æˆ–å…¬å…±ä»£ç†
                    }
                }

                try {
                    const resp = await fetch(url, {
                        method: 'GET',
                        credentials: 'omit',
                        referrer: CONFIG.PROXY_DEFAULT_REFERER || undefined,
                        referrerPolicy: 'no-referrer-when-downgrade',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    });
                    if (!resp.ok) {
                        const t = await resp.text().catch(() => '');
                        const err = new Error('http_error:' + resp.status + ' ' + resp.statusText + ' ' + (t || '').slice(0,200));
                        err.status = resp.status;
                        throw err;
                    }
                    const data = await resp.json();
                    let list = null;
                    if (Array.isArray(data)) list = data;
                    else if (data.value && Array.isArray(data.value.list)) list = data.value.list;
                    else if (Array.isArray(data.list)) list = data.list;
                    else if (data.data && Array.isArray(data.data.list)) list = data.data.list;
                    else throw new Error('no_list_in_response');
                    return list.map(normalizeApiItem).filter(i => i && i.period && i.number);
                } catch (e) {
                    console.warn('fetchHistoryPageRuntime error', e);
                    if (e && e.message && (e.message.indexOf('567') !== -1 || e.message.indexOf('blocked_by_edgeone') !== -1 || (e.status && e.status === 567))) {
                        throw new Error('blocked_by_edgeone');
                    }
                    throw e;
                }
            }

            try {
                const pageSizeLocal = 30;
                const maxRetries = 2;
                let allData = [];
                for (let pageNo = 1; pageNo <= totalPages; pageNo++) {
                    let attempt = 0;
                    let pageItems = [];
                    while (attempt <= maxRetries) {
                        try {
                            $('#historyList').html(`<div class="loading-state"><div class="spinner-large"></div><p>æ­£åœ¨è·å–å¼€å¥–æ•°æ®... ï¼ˆç¬¬ ${pageNo}/${totalPages} é¡µï¼‰</p></div>`);
                            pageItems = await fetchHistoryPageRuntime(pageNo, pageSizeLocal);
                            break;
                        } catch (err) {
                            attempt++;
                            console.warn('fetch page failed', pageNo, 'attempt', attempt, err);
                            if (err && err.message && err.message.indexOf('blocked_by_edgeone') !== -1) throw err;
                            if (attempt > maxRetries) throw err;
                            await new Promise(r => setTimeout(r, 600 * attempt));
                        }
                    }
                    if (pageItems && pageItems.length) allData = allData.concat(pageItems);
                    await new Promise(r => setTimeout(r, 200));
                }

                if (!allData || allData.length === 0) throw new Error('æœªè·å–åˆ°ä»»ä½•æ•°æ®');

                const unique = new Map();
                allData.forEach(item => { if (item.period && !unique.has(item.period)) unique.set(item.period, item); });
                state.historyNumbers = Array.from(unique.values()).sort((a, b) => parseInt(b.period || 0) - parseInt(a.period || 0));

                $('#historyList').html('');
                renderHistoryList();
                renderStats();
                setupFullHistoryTable();
                return true;
            } catch (error) {
                console.error('è·å–å¼€å¥–æ•°æ®å¤±è´¥:', error);

                // è‹¥å¯ç”¨äº†è‡ªåŠ¨ä»£ç†å°è¯•ï¼ˆé…ç½®æˆ–ç•Œé¢å¼€å¯ï¼‰ï¼Œå…ˆè‡ªåŠ¨å°è¯•ä»£ç†ï¼ˆä¼˜å…ˆï¼šè‡ªå®šä¹‰ -> CONFIG.PROXY_ENDPOINT -> å…¬å…±ä»£ç†ï¼‰
                try {
                    const autoUi = $('#autoProxyTry').length && $('#autoProxyTry').is(':checked');
                    const autoConfig = !!CONFIG.PROXY_AUTO_TRY;
                    const shouldAuto = autoConfig || autoUi;
                    if (shouldAuto) {
                        const custom = ($('#customProxy').val() || '').trim();
                        const proxies = [];
                        if (custom) proxies.push(custom);
                        if (CONFIG.PROXY_ENDPOINT) proxies.push(CONFIG.PROXY_ENDPOINT);
                        proxies.push('https://api.allorigins.win/raw?url=');
                        proxies.push('https://thingproxy.freeboard.io/fetch/');

                        const target = (CONFIG.API_URL || '').replace(/callback=\?/, '');
                        const ok = await attemptProxiesAndApply(proxies, target);
                        if (ok) return true; // ä»£ç†æˆåŠŸå¹¶åº”ç”¨æ•°æ®
                    }
                } catch (e) {
                    console.warn('auto proxy attempt failed', e);
                }

                $('#historyList').html('<div class="loading-state"><p style="color: var(--danger);">è·å–æ•°æ®å¤±è´¥ã€‚å¯å°è¯•ä»æœ¬åœ°å¯¼å…¥JSONã€ä½¿ç”¨ CORS ä»£ç†æˆ–ç²˜è´´JSONååº”ç”¨ã€‚</p></div>');
                $('#manualFetchFallback').show();
                $('#pasteJson').val('');
                $('#importFile').val('');
                try { $('#importFile').focus(); } catch(e){}
                $('#pasteJson').focus();
                state.historyNumbers = [];
                return false;
            } finally {
                state.isLoading = false;
            }
        }

       

        // ========== æ•°æ®åˆ†æåŠŸèƒ½ ==========

        /**
         * ç”Ÿæˆæ•°æ®åˆ†ææŠ¥å‘Š
         */
        function generateAnalysisReport() {
            const analysisPeriods = parseInt($('#analysisPeriods').val());
            const recentData = state.historyNumbers.slice(0, analysisPeriods);
            
            // 1. æ•°å­—çƒ­åº¦åˆ†æ
            const digitFreq = getDigitFrequency(recentData, analysisPeriods);
            const digitAnalysis = digitFreq.map((count, digit) => ({
                digit: digit,
                count: count,
                frequency: ((count / (analysisPeriods * 3)) * 100).toFixed(2) + '%'
            })).sort((a, b) => b.count - a.count);
            
            // 2. å’Œå€¼åˆ†å¸ƒåˆ†æ
            const sumFreq = {};
            recentData.forEach(item => {
                const sum = calcSum(item.number);
                sumFreq[sum] = (sumFreq[sum] || 0) + 1;
            });
            const sumAnalysis = Object.entries(sumFreq)
                .map(([sum, count]) => ({
                    sum: parseInt(sum),
                    count: count,
                    frequency: ((count / analysisPeriods) * 100).toFixed(2) + '%'
                }))
                .sort((a, b) => b.count - a.count);
            
            // 3. å¥‡å¶æ¯”åˆ†å¸ƒåˆ†æ
            const oddEvenFreq = {};
            recentData.forEach(item => {
                const oddEven = calcOddEven(item.number);
                oddEvenFreq[oddEven] = (oddEvenFreq[oddEven] || 0) + 1;
            });
            const oddEvenAnalysis = Object.entries(oddEvenFreq)
                .map(([ratio, count]) => ({
                    ratio: ratio,
                    count: count,
                    frequency: ((count / analysisPeriods) * 100).toFixed(2) + '%'
                }))
                .sort((a, b) => b.count - a.count);
            
            // 4. å¤§å°æ¯”åˆ†å¸ƒåˆ†æ
            const bigSmallFreq = {};
            recentData.forEach(item => {
                const bigSmall = calcBigSmall(item.number);
                bigSmallFreq[bigSmall] = (bigSmallFreq[bigSmall] || 0) + 1;
            });
            const bigSmallAnalysis = Object.entries(bigSmallFreq)
                .map(([ratio, count]) => ({
                    ratio: ratio,
                    count: count,
                    frequency: ((count / analysisPeriods) * 100).toFixed(2) + '%'
                }))
                .sort((a, b) => b.count - a.count);
            
            // 5. ç»„é€‰6å¥–é‡‘åˆ†æï¼ˆæ‰¾å‡ºå¤§ä¼—å·ï¼‰
            const zuxuan6Data = recentData.filter(item => isZuxuan6(item.number));
            const popularNumbers = zuxuan6Data
                .sort((a, b) => parseInt(a.prizeZuxuan6.stakeAmount) - parseInt(b.prizeZuxuan6.stakeAmount))
                .slice(0, 10) // å¥–é‡‘æœ€ä½çš„10ä¸ªå·ç ï¼ˆå¤§ä¼—å·ï¼‰
                .map(item => ({
                    number: item.number,
                    date: item.date,
                    period: item.period,
                    prizeAmount: item.prizeZuxuan6.stakeAmount,
                    stakeCount: item.prizeZuxuan6.stakeCount
                }));
            
            // ç”ŸæˆHTMLæŠ¥å‘Š
            let html = `
                <h3 style="color: var(--text-primary); margin-bottom: 16px; font-size: 1.2rem;">åŸºäºæœ€è¿‘ ${analysisPeriods} æœŸæ•°æ®çš„åˆ†ææŠ¥å‘Š</h3>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="color: var(--accent-blue); margin-bottom: 12px;">1. æ•°å­—çƒ­åº¦æ’å</h4>
                    <div class="stats-grid" style="grid-template-columns: repeat(5, 1fr);">
                        ${digitAnalysis.map(item => `
                            <div class="stat-item">
                                <div class="value" style="font-size: 1.8rem;">${item.digit}</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">å‡ºç° ${item.count} æ¬¡</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">${item.frequency}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="color: var(--accent-blue); margin-bottom: 12px;">2. å’Œå€¼åˆ†å¸ƒï¼ˆå‰10ï¼‰</h4>
                    <table style="width: 100%; border-collapse: collapse; background: var(--bg-secondary); border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: var(--bg-tertiary);">
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å’Œå€¼</th>
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å‡ºç°æ¬¡æ•°</th>
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">é¢‘ç‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sumAnalysis.slice(0, 10).map(item => `
                                <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s ease;">
                                    <td style="padding: 12px; color: var(--text-primary);">${item.sum}</td>
                                    <td style="padding: 12px; color: var(--text-secondary);">${item.count}</td>
                                    <td style="padding: 12px; color: var(--text-secondary);">${item.frequency}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div>
                        <h4 style="color: var(--accent-blue); margin-bottom: 12px;">3. å¥‡å¶æ¯”åˆ†å¸ƒ</h4>
                        <table style="width: 100%; border-collapse: collapse; background: var(--bg-secondary); border-radius: 8px; overflow: hidden;">
                            <thead>
                                <tr style="background: var(--bg-tertiary);">
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å¥‡å¶æ¯”</th>
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å‡ºç°æ¬¡æ•°</th>
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">é¢‘ç‡</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${oddEvenAnalysis.map(item => `
                                    <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s ease;">
                                        <td style="padding: 12px; color: var(--text-primary);">${item.ratio}</td>
                                        <td style="padding: 12px; color: var(--text-secondary);">${item.count}</td>
                                        <td style="padding: 12px; color: var(--text-secondary);">${item.frequency}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--accent-blue); margin-bottom: 12px;">4. å¤§å°æ¯”åˆ†å¸ƒ</h4>
                        <table style="width: 100%; border-collapse: collapse; background: var(--bg-secondary); border-radius: 8px; overflow: hidden;">
                            <thead>
                                <tr style="background: var(--bg-tertiary);">
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å¤§å°æ¯”</th>
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å‡ºç°æ¬¡æ•°</th>
                                    <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">é¢‘ç‡</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${bigSmallAnalysis.map(item => `
                                    <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s ease;">
                                        <td style="padding: 12px; color: var(--text-primary);">${item.ratio}</td>
                                        <td style="padding: 12px; color: var(--text-secondary);">${item.count}</td>
                                        <td style="padding: 12px; color: var(--text-secondary);">${item.frequency}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="color: var(--accent-blue); margin-bottom: 12px;">5. å¤§ä¼—å·åˆ†æï¼ˆå¥–é‡‘æœ€ä½çš„10ä¸ªç»„é€‰6å·ç ï¼‰</h4>
                    <table style="width: 100%; border-collapse: collapse; background: var(--bg-secondary); border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: var(--bg-tertiary);">
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">æœŸå·</th>
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">æ—¥æœŸ</th>
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å·ç </th>
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">å¥–é‡‘ (å…ƒ)</th>
                                <th style="padding: 12px; text-align: left; color: var(--text-primary); border-bottom: 1px solid var(--border-color);">ä¸­å¥–æ³¨æ•°</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${popularNumbers.map(item => `
                                <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s ease;">
                                    <td style="padding: 12px; color: var(--text-primary); font-family: monospace;">${item.period}</td>
                                    <td style="padding: 12px; color: var(--text-secondary);">${item.date}</td>
                                    <td style="padding: 12px; color: var(--accent-cyan); font-weight: 600; font-family: monospace; letter-spacing: 2px;">${item.number}</td>
                                    <td style="padding: 12px; color: var(--danger);">${item.prizeAmount}</td>
                                    <td style="padding: 12px; color: var(--text-secondary);">${item.stakeCount}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            $('#analysisContent').html(html);
            $('#analysisSection').show();
        }

        // ========== ç­–ç•¥å¼•æ“ ==========

        /**
         * ç­–ç•¥Aï¼šæ•°å­¦å‡åŒ€åˆ†å¸ƒå¼•æ“
         *
         * æ ¸å¿ƒé€»è¾‘ï¼š
         * 1. åœ¨å’Œå€¼åˆ†å¸ƒä¸Šå‡åŒ€ï¼ˆä½ã€ä¸­ã€é«˜ï¼‰
         * 2. åœ¨è·¨åº¦åˆ†å¸ƒä¸Šå‡åŒ€ï¼ˆå°ã€ä¸­ã€å¤§ï¼‰
         * 3. é¿å…ç­‰å·®æ•°åˆ—å’Œæ˜æ˜¾æ¨¡å¼
         * 4. ä¸‰æ³¨ä¹‹é—´ä¿æŒå·®å¼‚åŒ–
         */
        function strategyMathUniform(options) {
            const { strictMode, aggressiveMode, avoidPeriods } = options;
            const results = [];
            const usedSorted = new Set();

            // è·å–éœ€è¦é¿å¼€çš„æ•°å­—ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
            const avoidDigits = strictMode ? getAvoidDigits(avoidPeriods) : new Set();

            // ç›®æ ‡ï¼šç”Ÿæˆä¸‰æ³¨åœ¨å’Œå€¼åŒºé—´ä¸Šåˆ†æ•£çš„å·ç 
            // å’Œå€¼èŒƒå›´ï¼š0+1+2=3 åˆ° 7+8+9=24ï¼Œä¸­é—´å€¼çº¦13-14
            // åˆ†ä¸ºï¼šä½(3-10)ã€ä¸­(11-16)ã€é«˜(17-24)
            const sumRanges = [
                { min: 3, max: 10, label: 'ä½å’Œå€¼' },
                { min: 11, max: 16, label: 'ä¸­å’Œå€¼' },
                { min: 17, max: 24, label: 'é«˜å’Œå€¼' }
            ];

            for (let i = 0; i < 3; i++) {
                const targetRange = sumRanges[i];
                let attempts = 0;
                let found = false;

                while (!found && attempts < 500) {
                    attempts++;
                    const num = generateRandomZuxuan6(avoidDigits, aggressiveMode);
                    if (!num) continue;

                    const sum = calcSum(num);
                    const sorted = sortNumber(num);

                    // æ£€æŸ¥æ¡ä»¶
                    if (sum >= targetRange.min && sum <= targetRange.max &&
                        !usedSorted.has(sorted) &&
                        !isHotspot(num) &&
                        !isArithmeticSequence(num) &&
                        !isRecentNumber(num, avoidPeriods)) {

                        results.push({
                            number: num,
                            analysis: generateAnalysis(num, 'math', targetRange.label)
                        });
                        usedSorted.add(sorted);
                        found = true;
                    }
                }

                // å¦‚æœç‰¹å®šèŒƒå›´æ‰¾ä¸åˆ°ï¼Œæ”¾å®½æ¡ä»¶
                if (!found) {
                    let fallbackAttempts = 0;
                    while (!found && fallbackAttempts < 200) {
                        fallbackAttempts++;
                        const num = generateRandomZuxuan6(aggressiveMode ? new Set() : avoidDigits, aggressiveMode);
                        if (!num) continue;

                        const sorted = sortNumber(num);
                        if (!usedSorted.has(sorted) && !isHotspot(num) && !isRecentNumber(num, avoidPeriods)) {
                            results.push({
                                number: num,
                                analysis: generateAnalysis(num, 'math', 'å‡è¡¡åˆ†å¸ƒ')
                            });
                            usedSorted.add(sorted);
                            found = true;
                        }
                    }
                }
            }

            return results;
        }

        /**
         * ç­–ç•¥Bï¼šè¿½çƒ­é¿å†·ï¼ˆé¡ºåŠ¿è€Œä¸ºï¼‰
         *
         * æ ¸å¿ƒé€»è¾‘ï¼š
         * 1. æ‰¾å‡ºè¿‘æœŸçƒ­ç ï¼ˆå‡ºç°é¢‘ç‡æœ€é«˜çš„2-3ä¸ªæ•°å­—ï¼‰
         * 2. æ‰¾å‡ºè¿‘æœŸçƒ­å’Œå€¼åŒºé—´
         * 3. å°†çƒ­ç ä½œä¸ºæ ¸å¿ƒï¼Œç»„åˆç”Ÿæˆå·ç 
         * 4. ç¡®ä¿å’Œå€¼è½åœ¨çƒ­åŒº
         */
        function strategyHotTrend(options) {
            const { strictMode, aggressiveMode, avoidPeriods, analysisPeriods } = options;
            const results = [];
            const usedSorted = new Set();
            const recentData = state.historyNumbers.slice(0, analysisPeriods);
            
            // è·å–éœ€è¦é¿å¼€çš„æ•°å­—ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
            const avoidDigits = strictMode ? getAvoidDigits(avoidPeriods) : new Set();
            
            // 1. æ‰¾å‡ºçƒ­ç ï¼ˆå‡ºç°é¢‘ç‡æœ€é«˜çš„3ä¸ªæ•°å­—ï¼‰
            const digitFreq = getDigitFrequency(recentData, analysisPeriods);
            const hotDigits = digitFreq
                .map((count, digit) => ({ digit, count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 3)
                .map(item => item.digit);
            
            // 2. æ‰¾å‡ºçƒ­å’Œå€¼åŒºé—´ï¼ˆå‡ºç°é¢‘ç‡æœ€é«˜çš„5ä¸ªå’Œå€¼ï¼‰
            const sumFreq = {};
            recentData.forEach(item => {
                const sum = calcSum(item.number);
                sumFreq[sum] = (sumFreq[sum] || 0) + 1;
            });
            const hotSums = Object.entries(sumFreq)
                .map(([sum, count]) => ({ sum: parseInt(sum), count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 5)
                .map(item => item.sum);
            
            // 3. ç”Ÿæˆå·ç ï¼ŒåŒ…å«è‡³å°‘1ä¸ªçƒ­ç ï¼Œå’Œå€¼ä¸ºçƒ­å’Œå€¼
            for (let i = 0; i < 3; i++) {
                let attempts = 0;
                let found = false;
                
                while (!found && attempts < 500) {
                    attempts++;
                    
                    // ç¡®ä¿åŒ…å«è‡³å°‘ä¸€ä¸ªçƒ­ç 
                    let digits;
                    do {
                        digits = [];
                        // å…ˆé€‰ä¸€ä¸ªçƒ­ç 
                        digits.push(hotDigits[Math.floor(Math.random() * hotDigits.length)]);
                        // å†é€‰ä¸¤ä¸ªéšæœºæ•°å­—ï¼ˆå¯ä»¥æ˜¯çƒ­ç ï¼‰
                        while (digits.length < 3) {
                            const d = Math.floor(Math.random() * 10);
                            if (!digits.includes(d) && !avoidDigits.has(d)) {
                                digits.push(d);
                            }
                        }
                    } while (digits.length < 3);
                    
                    // æ‰“ä¹±é¡ºåºç”Ÿæˆå·ç 
                    const shuffled = [...digits].sort(() => Math.random() - 0.5);
                    const num = shuffled.join('');
                    const sorted = sortNumber(num);
                    const sum = calcSum(num);
                    
                    // æ£€æŸ¥æ¡ä»¶ï¼šåŒ…å«çƒ­ç ï¼Œå’Œå€¼ä¸ºçƒ­å’Œå€¼ï¼Œä¸æ˜¯çƒ­ç‚¹ç»„åˆï¼Œä¸æ˜¯è¿‘æœŸå·ç 
                    if (hotSums.includes(sum) &&
                        !usedSorted.has(sorted) &&
                        !isHotspot(num) &&
                        !isRecentNumber(num, avoidPeriods)) {
                        
                        results.push({
                            number: num,
                            analysis: generateAnalysis(num, 'hot', 'è¿½çƒ­é¿å†·')
                        });
                        usedSorted.add(sorted);
                        found = true;
                    }
                }
                
                // å¤‡ç”¨æ–¹æ¡ˆï¼šæ”¾å®½æ¡ä»¶
                if (!found) {
                    let fallbackAttempts = 0;
                    while (!found && fallbackAttempts < 200) {
                        fallbackAttempts++;
                        const num = generateRandomZuxuan6(aggressiveMode ? new Set() : avoidDigits, aggressiveMode);
                        if (!num) continue;
                        
                        const sorted = sortNumber(num);
                        if (!usedSorted.has(sorted) && !isHotspot(num) && !isRecentNumber(num, avoidPeriods)) {
                            results.push({
                                number: num,
                                analysis: generateAnalysis(num, 'hot', 'è¿½çƒ­é¿å†·ï¼ˆæ”¾å®½æ¡ä»¶ï¼‰')
                            });
                            usedSorted.add(sorted);
                            found = true;
                        }
                    }
                }
            }
            
            return results;
        }

        /**
         * ç­–ç•¥Cï¼šèµŒå†·å›å½’ï¼ˆé€†åŠ¿åšå¼ˆï¼‰
         *
         * æ ¸å¿ƒé€»è¾‘ï¼š
         * 1. æ‰¾å‡ºé•¿æœŸé—æ¼çš„å†·ç 
         * 2. æ‰¾å‡ºè¿‘æœŸå‡ºç°æœ€å°‘çš„å’Œå€¼
         * 3. å¤§èƒ†é€‰ç”¨1-2ä¸ªé¡¶çº§å†·ç ï¼Œæ­é…ä¸­æ€§ç ç»„åˆ
         */
        function strategyColdReturn(options) {
            const { strictMode, aggressiveMode, avoidPeriods, analysisPeriods } = options;
            const results = [];
            const usedSorted = new Set();
            const recentData = state.historyNumbers.slice(0, analysisPeriods);
            
            // è·å–éœ€è¦é¿å¼€çš„æ•°å­—ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
            const avoidDigits = strictMode ? getAvoidDigits(avoidPeriods) : new Set();
            
            // 1. æ‰¾å‡ºå†·ç ï¼ˆå‡ºç°é¢‘ç‡æœ€ä½çš„3ä¸ªæ•°å­—ï¼‰
            const digitFreq = getDigitFrequency(recentData, analysisPeriods);
            const coldDigits = digitFreq
                .map((count, digit) => ({ digit, count }))
                .sort((a, b) => a.count - b.count)
                .slice(0, 3)
                .map(item => item.digit);
            
            // 2. æ‰¾å‡ºå†·å’Œå€¼ï¼ˆå‡ºç°é¢‘ç‡æœ€ä½çš„5ä¸ªå’Œå€¼ï¼‰
            const sumFreq = {};
            recentData.forEach(item => {
                const sum = calcSum(item.number);
                sumFreq[sum] = (sumFreq[sum] || 0) + 1;
            });
            const coldSums = Object.entries(sumFreq)
                .map(([sum, count]) => ({ sum: parseInt(sum), count }))
                .sort((a, b) => a.count - b.count)
                .slice(0, 5)
                .map(item => item.sum);
            
            // 3. ç”Ÿæˆå·ç ï¼ŒåŒ…å«è‡³å°‘1ä¸ªå†·ç ï¼Œå’Œå€¼ä¸ºå†·å’Œå€¼
            for (let i = 0; i < 3; i++) {
                let attempts = 0;
                let found = false;
                
                while (!found && attempts < 500) {
                    attempts++;
                    
                    // ç¡®ä¿åŒ…å«è‡³å°‘ä¸€ä¸ªå†·ç 
                    let digits;
                    do {
                        digits = [];
                        // å…ˆé€‰ä¸€ä¸ªå†·ç 
                        digits.push(coldDigits[Math.floor(Math.random() * coldDigits.length)]);
                        // å†é€‰ä¸¤ä¸ªéšæœºæ•°å­—ï¼ˆå¯ä»¥æ˜¯å†·ç ï¼‰
                        while (digits.length < 3) {
                            const d = Math.floor(Math.random() * 10);
                            if (!digits.includes(d) && !avoidDigits.has(d)) {
                                digits.push(d);
                            }
                        }
                    } while (digits.length < 3);
                    
                    // æ‰“ä¹±é¡ºåºç”Ÿæˆå·ç 
                    const shuffled = [...digits].sort(() => Math.random() - 0.5);
                    const num = shuffled.join('');
                    const sorted = sortNumber(num);
                    const sum = calcSum(num);
                    
                    // æ£€æŸ¥æ¡ä»¶ï¼šåŒ…å«å†·ç ï¼Œå’Œå€¼ä¸ºå†·å’Œå€¼ï¼Œä¸æ˜¯çƒ­ç‚¹ç»„åˆï¼Œä¸æ˜¯è¿‘æœŸå·ç 
                    if (coldSums.includes(sum) &&
                        !usedSorted.has(sorted) &&
                        !isHotspot(num) &&
                        !isRecentNumber(num, avoidPeriods)) {
                        
                        results.push({
                            number: num,
                            analysis: generateAnalysis(num, 'coldreturn', 'èµŒå†·å›å½’')
                        });
                        usedSorted.add(sorted);
                        found = true;
                    }
                }
                
                // å¤‡ç”¨æ–¹æ¡ˆï¼šæ”¾å®½æ¡ä»¶
                if (!found) {
                    let fallbackAttempts = 0;
                    while (!found && fallbackAttempts < 200) {
                        fallbackAttempts++;
                        const num = generateRandomZuxuan6(aggressiveMode ? new Set() : avoidDigits, aggressiveMode);
                        if (!num) continue;
                        
                        const sorted = sortNumber(num);
                        if (!usedSorted.has(sorted) && !isHotspot(num) && !isRecentNumber(num, avoidPeriods)) {
                            results.push({
                                number: num,
                                analysis: generateAnalysis(num, 'coldreturn', 'èµŒå†·å›å½’ï¼ˆæ”¾å®½æ¡ä»¶ï¼‰')
                            });
                            usedSorted.add(sorted);
                            found = true;
                        }
                    }
                }
            }
            
            return results;
        }

        /**
         * ç­–ç•¥Dï¼šç²¾ç¡®é€†å‘ï¼ˆåˆ©ç”¨å¥–é‡‘æ•°æ®ï¼‰
         *
         * æ ¸å¿ƒé€»è¾‘ï¼š
         * 1. æ‰¾å‡ºå¯¼è‡´ç»„é€‰6å¥–é‡‘æœ€ä½çš„å·ç ï¼ˆå¤§ä¼—å·ï¼‰
         * 2. é¿å¼€è¿™äº›å¤§ä¼—å·
         * 3. é¿å¼€ä¸å¤§ä¼—å·æ•°å­—ç»„åˆé«˜åº¦ç›¸ä¼¼çš„å·ç 
         * 4. ç”Ÿæˆä¸å¤§ä¼—å·ç‰¹å¾ç›¸åçš„å·ç 
         */
        function strategyPrecisionReverse(options) {
            const { strictMode, aggressiveMode, avoidPeriods, analysisPeriods } = options;
            const results = [];
            const usedSorted = new Set();
            const recentData = state.historyNumbers.slice(0, analysisPeriods);
            
            // è·å–éœ€è¦é¿å¼€çš„æ•°å­—ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
            const avoidDigits = strictMode ? getAvoidDigits(avoidPeriods) : new Set();
            
            // 1. æ‰¾å‡ºå¤§ä¼—å·ï¼ˆå¥–é‡‘æœ€ä½çš„10ä¸ªç»„é€‰6å·ç ï¼‰
            const zuxuan6Data = recentData.filter(item => isZuxuan6(item.number));
            const popularNumbers = zuxuan6Data
                .sort((a, b) => parseInt(a.prizeZuxuan6.stakeAmount) - parseInt(b.prizeZuxuan6.stakeAmount))
                .slice(0, 10)
                .map(item => item.number);
            
            // 2. æ‰¾å‡ºå¤§ä¼—å·ä¸­é¢‘ç¹å‡ºç°çš„æ•°å­—ï¼ˆéœ€è¦é¿å¼€çš„æ•°å­—ï¼‰
            const popularDigits = new Set();
            popularNumbers.forEach(num => {
                parseNumber(num).forEach(d => popularDigits.add(d));
            });
            
            // 3. ç”Ÿæˆå·ç ï¼Œé¿å¼€å¤§ä¼—å·åŠå…¶ç›¸ä¼¼å·ç 
            for (let i = 0; i < 3; i++) {
                let attempts = 0;
                let found = false;
                
                while (!found && attempts < 500) {
                    attempts++;
                    
                    // ç”Ÿæˆå·ç ï¼Œå°½é‡é¿å¼€å¤§ä¼—å·æ•°å­—
                    let digits;
                    do {
                        digits = [];
                        while (digits.length < 3) {
                            const d = Math.floor(Math.random() * 10);
                            if (!digits.includes(d) && !avoidDigits.has(d)) {
                                digits.push(d);
                            }
                        }
                    } while (digits.length < 3);
                    
                    const num = digits.join('');
                    const sorted = sortNumber(num);
                    const numDigits = new Set(digits);
                    
                    // æ£€æŸ¥æ˜¯å¦ä¸å¤§ä¼—å·é«˜åº¦ç›¸ä¼¼ï¼ˆåŒ…å«2ä¸ªä»¥ä¸Šç›¸åŒæ•°å­—ï¼‰
                    let isSimilar = false;
                    for (const popularNum of popularNumbers) {
                        const popularNumDigits = new Set(parseNumber(popularNum));
                        const intersection = [...numDigits].filter(d => popularNumDigits.has(d));
                        if (intersection.length >= 2) {
                            isSimilar = true;
                            break;
                        }
                    }
                    
                    // æ£€æŸ¥æ¡ä»¶ï¼šä¸æ˜¯å¤§ä¼—å·ï¼Œä¸ä¸å¤§ä¼—å·é«˜åº¦ç›¸ä¼¼ï¼Œä¸æ˜¯çƒ­ç‚¹ç»„åˆï¼Œä¸æ˜¯è¿‘æœŸå·ç 
                    if (!isSimilar &&
                        !popularNumbers.includes(num) &&
                        !usedSorted.has(sorted) &&
                        !isHotspot(num) &&
                        !isRecentNumber(num, avoidPeriods)) {
                        
                        results.push({
                            number: num,
                            analysis: generateAnalysis(num, 'precision', 'ç²¾ç¡®é€†å‘')
                        });
                        usedSorted.add(sorted);
                        found = true;
                    }
                }
                
                // å¤‡ç”¨æ–¹æ¡ˆï¼šæ”¾å®½æ¡ä»¶
                if (!found) {
                    let fallbackAttempts = 0;
                    while (!found && fallbackAttempts < 200) {
                        fallbackAttempts++;
                        const num = generateRandomZuxuan6(aggressiveMode ? new Set() : avoidDigits, aggressiveMode);
                        if (!num) continue;
                        
                        const sorted = sortNumber(num);
                        if (!usedSorted.has(sorted) && !isHotspot(num) && !isRecentNumber(num, avoidPeriods)) {
                            results.push({
                                number: num,
                                analysis: generateAnalysis(num, 'precision', 'ç²¾ç¡®é€†å‘ï¼ˆæ”¾å®½æ¡ä»¶ï¼‰')
                            });
                            usedSorted.add(sorted);
                            found = true;
                        }
                    }
                }
            }
            
            return results;
        }

        /**
         * ç­–ç•¥Bï¼šæ–‡åŒ–é¿å¼€ç­–ç•¥å¼•æ“
         *
         * æ ¸å¿ƒé€»è¾‘ï¼š
         * 1. ä¸»åŠ¨é¿å¼€å‰åˆ©æ•°å­— 6ã€8ã€9
         * 2. ä¼˜å…ˆä½¿ç”¨"ä¸­æ€§"æ•°å­— 0ã€2ã€3ã€5ã€7
         * 3. å¯åŒ…å«é€‚é‡çš„"4"ï¼ˆæ¿€è¿›æ¨¡å¼ï¼‰
         * 4. ç”Ÿæˆè§†è§‰ä¸Š"ä¸ç¾è§‚"çš„ç»„åˆ
         */
        function strategyCultureAvoid(options) {
            const { strictMode, aggressiveMode, avoidPeriods } = options;
            const results = [];
            const usedSorted = new Set();

            // æ–‡åŒ–é¿å¼€æ•°å­—æ± 
            // ä¼˜å…ˆæ•°å­—ï¼š0, 1, 2, 3, 5, 7ï¼ˆä¸åŒ…å«6ã€8ã€9ï¼‰
            // æ¿€è¿›æ¨¡å¼é¢å¤–åŒ…å«ï¼š4
            let preferredDigits = [0, 1, 2, 3, 5, 7];
            if (aggressiveMode) {
                preferredDigits.push(4);
            }

            // è·å–éœ€è¦é¿å¼€çš„æ•°å­—ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
            const avoidDigits = strictMode ? getAvoidDigits(avoidPeriods) : new Set();

            // ä»ä¼˜å…ˆæ•°å­—ä¸­ç§»é™¤éœ€è¦é¿å¼€çš„
            const availableDigits = preferredDigits.filter(d => !avoidDigits.has(d));

            for (let i = 0; i < 3; i++) {
                let attempts = 0;
                let found = false;

                while (!found && attempts < 500) {
                    attempts++;

                    // ä»å¯ç”¨æ•°å­—ä¸­éšæœºé€‰3ä¸ªä¸åŒçš„
                    if (availableDigits.length < 3) {
                        // å¯ç”¨æ•°å­—ä¸è¶³ï¼Œæ”¾å®½é™åˆ¶
                        break;
                    }

                    const shuffled = [...availableDigits].sort(() => Math.random() - 0.5);
                    const selected = shuffled.slice(0, 3);
                    const num = selected.join('');
                    const sorted = sortNumber(num);

                    if (!usedSorted.has(sorted) &&
                        !isHotspot(num) &&
                        !isRecentNumber(num, avoidPeriods)) {

                        results.push({
                            number: num,
                            analysis: generateAnalysis(num, 'culture')
                        });
                        usedSorted.add(sorted);
                        found = true;
                    }
                }

                // å¤‡ç”¨æ–¹æ¡ˆï¼šæ”¾å®½æ¡ä»¶
                if (!found) {
                    let fallbackAttempts = 0;
                    const fallbackDigits = aggressiveMode ? [0,1,2,3,4,5,7] : [0,1,2,3,5,7];

                    while (!found && fallbackAttempts < 200) {
                        fallbackAttempts++;
                        const shuffled = [...fallbackDigits].sort(() => Math.random() - 0.5);
                        const selected = shuffled.slice(0, 3);
                        const num = selected.join('');
                        const sorted = sortNumber(num);

                        if (!usedSorted.has(sorted) && !isHotspot(num)) {
                            results.push({
                                number: num,
                                analysis: generateAnalysis(num, 'culture')
                            });
                            usedSorted.add(sorted);
                            found = true;
                        }
                    }
                }
            }

            return results;
        }

        /**
         * ç­–ç•¥Cï¼šè¿‘æœŸçƒ­å·å†·åƒ»ç­–ç•¥å¼•æ“
         *
         * æ ¸å¿ƒé€»è¾‘ï¼š
         * 1. åˆ†æè¿‘æœŸå¼€å¥–å·ç ä¸­å„æ•°å­—å‡ºç°é¢‘ç‡
         * 2. ä¼˜å…ˆé€‰æ‹©å‡ºç°é¢‘ç‡æœ€ä½çš„"å†·å·"
         * 3. æœ€å¤§ç¨‹åº¦é¿å¼€çƒ­é—¨æ•°å­—
         */
        function strategyColdNumbers(options) {
            const { strictMode, aggressiveMode, avoidPeriods } = options;
            const results = [];
            const usedSorted = new Set();

            // è®¡ç®—æ•°å­—é¢‘ç‡
            const freq = getDigitFrequency(state.historyNumbers, avoidPeriods);

            // æŒ‰é¢‘ç‡æ’åºï¼ˆå‡åºï¼‰ï¼Œè·å–å†·å·
            const sortedDigits = Array.from({length: 10}, (_, i) => i)
                .sort((a, b) => freq[a] - freq[b]);

            // è·å–æœ€å†·çš„æ•°å­—ï¼ˆé¢‘ç‡æœ€ä½çš„å‰6ä¸ªï¼‰
            let coldDigits = sortedDigits.slice(0, 7);

            // ä¸¥æ ¼æ¨¡å¼ï¼šè¿›ä¸€æ­¥è¿‡æ»¤
            if (strictMode) {
                const avoidDigits = getAvoidDigits(avoidPeriods);
                coldDigits = coldDigits.filter(d => !avoidDigits.has(d));
            }

            // éæ¿€è¿›æ¨¡å¼ï¼šç§»é™¤4
            if (!aggressiveMode) {
                coldDigits = coldDigits.filter(d => d !== 4);
            }

            for (let i = 0; i < 3; i++) {
                let attempts = 0;
                let found = false;

                while (!found && attempts < 500) {
                    attempts++;

                    // ä¼˜å…ˆä»å†·å·ä¸­é€‰æ‹©
                    let pool = coldDigits.length >= 3 ? coldDigits : sortedDigits.slice(0, 7);
                    if (!aggressiveMode) {
                        pool = pool.filter(d => d !== 4);
                    }

                    if (pool.length < 3) {
                        pool = [0,1,2,3,5,6,7,8,9];
                    }

                    const shuffled = [...pool].sort(() => Math.random() - 0.5);
                    const selected = shuffled.slice(0, 3);

                    // ç¡®ä¿ä¸‰ä¸ªæ•°å­—ä¸åŒ
                    if (new Set(selected).size !== 3) continue;

                    const num = selected.join('');
                    const sorted = sortNumber(num);

                    if (!usedSorted.has(sorted) &&
                        !isHotspot(num) &&
                        !isRecentNumber(num, avoidPeriods)) {

                        results.push({
                            number: num,
                            analysis: generateAnalysis(num, 'cold', freq)
                        });
                        usedSorted.add(sorted);
                        found = true;
                    }
                }

                // å¤‡ç”¨æ–¹æ¡ˆ
                if (!found) {
                    let fallbackAttempts = 0;
                    while (!found && fallbackAttempts < 200) {
                        fallbackAttempts++;
                        const num = generateRandomZuxuan6(new Set(), aggressiveMode);
                        if (!num) continue;

                        const sorted = sortNumber(num);
                        if (!usedSorted.has(sorted) && !isHotspot(num)) {
                            results.push({
                                number: num,
                                analysis: generateAnalysis(num, 'cold', freq)
                            });
                            usedSorted.add(sorted);
                            found = true;
                        }
                    }
                }
            }

            return results;
        }

        /**
         * ç”Ÿæˆéšæœºç»„é€‰6å·ç 
         */
        function generateRandomZuxuan6(avoidDigits = new Set(), allowFour = false) {
            let pool = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9].filter(d => !avoidDigits.has(d));
            if (!allowFour) {
                pool = pool.filter(d => d !== 4);
            }

            if (pool.length < 3) return null;

            const shuffled = pool.sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, 3);
            return selected.join('');
        }

        /**
         * è·å–éœ€è¦é¿å¼€çš„æ•°å­—ï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰
         */
        function getAvoidDigits(periods) {
            const digits = new Set();
            state.historyNumbers.slice(0, periods).forEach(item => {
                parseNumber(item.number).forEach(d => digits.add(d));
            });
            return digits;
        }

        /**
         * æ£€æŸ¥æ˜¯å¦ä¸è¿‘æœŸå·ç é‡å¤
         */
        function isRecentNumber(num, periods) {
            const sorted = sortNumber(num);
            return state.historyNumbers.slice(0, periods).some(item =>
                sortNumber(item.number) === sorted
            );
        }

        /**
         * ç”Ÿæˆç­–ç•¥åˆ†ææ–‡æœ¬
         */
        function generateAnalysis(num, strategy, extra = null) {
            const sum = calcSum(num);
            const span = calcSpan(num);
            const oddEven = calcOddEven(num);
            const bigSmall = calcBigSmall(num);
            const digits = parseNumber(num);

            let baseAnalysis = `å’Œå€¼<span class="highlight">${sum}</span>ï¼Œè·¨åº¦<span class="highlight">${span}</span>ï¼Œå¥‡å¶æ¯”${oddEven}ï¼Œå¤§å°æ¯”${bigSmall}ã€‚`;

            switch (strategy) {
                case 'math':
                    baseAnalysis += ` æ­¤ç»„åˆå±äº<span class="highlight">${extra || 'å‡è¡¡åˆ†å¸ƒ'}</span>åŒºé—´ï¼Œéç­‰å·®æ•°åˆ—ï¼Œæ•°å­—åˆ†å¸ƒå‡åŒ€ã€‚`;
                    break;
                case 'culture':
                    const hasLucky = digits.some(d => [6, 8, 9].includes(d));
                    if (!hasLucky) {
                        baseAnalysis += ` å®Œå…¨é¿å¼€å‰åˆ©æ•°å­—6ã€8ã€9ï¼Œä½¿ç”¨<span class="highlight">ä¸­æ€§æ•°å­—</span>ç»„åˆã€‚`;
                    } else {
                        baseAnalysis += ` ä»¥ä¸­æ€§æ•°å­—ä¸ºä¸»ï¼Œè§†è§‰ä¸Š<span class="highlight">"ä¸è®¨å–œ"</span>ï¼Œé¿å¼€å¤§ä¼—åå¥½ã€‚`;
                    }
                    break;
                case 'cold':
                    if (extra) {
                        const coldInfo = digits.map(d => `${d}(é¢‘${extra[d]}æ¬¡)`).join('ã€');
                        baseAnalysis += ` ä½¿ç”¨å†·å·ï¼š${coldInfo}ï¼Œ<span class="highlight">è¿‘æœŸä½é¢‘</span>ç»„åˆã€‚`;
                    }
                    break;
            }

            return baseAnalysis;
        }

        /**
         * ä¸»ç”Ÿæˆå‡½æ•°
         */
        function generateNumbers(strategy) {
            const options = {
                strictMode: $('#strictMode').is(':checked'),
                aggressiveMode: $('#aggressiveMode').is(':checked'),
                avoidPeriods: parseInt($('#avoidPeriods').val()),
                analysisPeriods: parseInt($('#analysisPeriods').val())
            };

            switch (strategy) {
                case 'math':
                    return strategyMathUniform(options);
                case 'culture':
                    return strategyCultureAvoid(options);
                case 'cold':
                    return strategyColdNumbers(options);
                case 'hot':
                    return strategyHotTrend(options);
                case 'coldreturn':
                    return strategyColdReturn(options);
                case 'precision':
                    return strategyPrecisionReverse(options);
                default:
                    return strategyMathUniform(options);
            }
        }

        // ========== UI æ¸²æŸ“å‡½æ•° ==========

        /**
         * æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
         */
        function renderHistoryList() {
            const $list = $('#historyList');

            if (state.historyNumbers.length === 0) {
                $list.html('<div class="loading-state"><p>æš‚æ— æ•°æ®</p></div>');
                return;
            }

            let html = '';
            state.historyNumbers.forEach((item, index) => {
                html += `
                    <div class="history-item" data-index="${index}">
                        <div>
                            <span class="num">${item.number}</span>
                            <span class="date">${item.date} ç¬¬${item.period}æœŸ</span>
                        </div>
                        <button class="delete-btn" data-index="${index}">Ã—</button>
                    </div>
                `;
            });

            $list.html(html);
        }

        /**
         * æ¸²æŸ“çƒ­ç‚¹å·ç 
         */
        function renderHotspots() {
            const displayHotspots = [
                '123', '456', '789', '147', '258', '369',
                '666', '888', '168', '268', '518', '618',
                '520', '521', '741', '852', '963', '159'
            ];

            let html = '';
            displayHotspots.forEach(num => {
                html += `<span class="hotspot-tag">${num}</span>`;
            });

            $('#hotspotGrid').html(html);
        }

        /**
         * æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯
         */
        function renderStats() {
            const periods = parseInt($('#avoidPeriods').val());
            const freq = getDigitFrequency(state.historyNumbers, periods);

            // æ‰¾å‡ºæœ€çƒ­å’Œæœ€å†·çš„æ•°å­—
            let maxFreq = Math.max(...freq);
            let minFreq = Math.min(...freq);

            const hotDigits = freq.map((f, i) => ({ digit: i, freq: f }))
                .filter(item => item.freq === maxFreq)
                .map(item => item.digit);

            const coldDigits = freq.map((f, i) => ({ digit: i, freq: f }))
                .filter(item => item.freq === minFreq)
                .map(item => item.digit);

            const html = `
                <div class="stat-item">
                    <div class="value">${hotDigits.join(', ')}</div>
                    <div class="label">çƒ­å· (${maxFreq}æ¬¡)</div>
                </div>
                <div class="stat-item">
                    <div class="value">${coldDigits.join(', ')}</div>
                    <div class="label">å†·å· (${minFreq}æ¬¡)</div>
                </div>
            `;

            $('#statsGrid').html(html);
        }

        /* ========== å®Œæ•´å¼€å¥–è®°å½•è¡¨æ ¼åŠŸèƒ½ ========== */
        function setupFullHistoryTable() {
            const pageSize = 50;
            state.fullTable = state.fullTable || {};
            state.fullTable.pageSize = pageSize;
            state.fullTable.currentPage = 0;
            state.fullTable.totalPages = Math.ceil((state.historyNumbers || []).length / pageSize);
            state.fullTable.loading = false;

            const $tbody = $('#fullHistoryTable tbody');
            $tbody.html('');

            if ((state.historyNumbers || []).length === 0) {
                $tbody.html('<tr><td colspan="11" style="text-align:center;color:var(--text-secondary);padding:20px;">æš‚æ— æ•°æ®</td></tr>');
                $('#loadMoreBtn').prop('disabled', true).text('æš‚æ— æ•°æ®');
                return;
            }

            $('#loadMoreBtn').prop('disabled', false).text('åŠ è½½æ›´å¤š');
            // åŠ è½½ç¬¬ä¸€é¡µ
            loadNextTablePage();
        }

        function loadNextTablePage() {
            if (!state.fullTable) setupFullHistoryTable();
            if (state.fullTable.loading) return;
            if (state.fullTable.currentPage >= state.fullTable.totalPages) return;

            state.fullTable.loading = true;
            $('#loadMoreBtn').text('åŠ è½½ä¸­...').prop('disabled', true);

            const start = state.fullTable.currentPage * state.fullTable.pageSize;
            const end = start + state.fullTable.pageSize;
            const rows = (state.historyNumbers || []).slice(start, end);
            const $tbody = $('#fullHistoryTable tbody');

            rows.forEach(item => {
                const num = item.rawResult || (item.number || '').split('').join(' ');
                const zhixuanCount = item.prizeZhixuan ? item.prizeZhixuan.stakeCount : '-';
                const zhixuanAmt = item.prizeZhixuan ? item.prizeZhixuan.stakeAmount : '-';
                const z3Count = item.prizeZuxuan3 ? item.prizeZuxuan3.stakeCount : '-';
                const z3Amt = item.prizeZuxuan3 ? item.prizeZuxuan3.stakeAmount : '-';
                const z6Count = item.prizeZuxuan6 ? item.prizeZuxuan6.stakeCount : '-';
                const z6Amt = item.prizeZuxuan6 ? item.prizeZuxuan6.stakeAmount : '-';
                const sale = item.totalSaleAmount || '-';
                const pdf = item.drawPdfUrl ? `<a href="${item.drawPdfUrl}" target="_blank">å…¬å‘Š</a>` : (item.lotteryNotice ? 'æœ‰' : '-');

                $tbody.append(`
                    <tr>
                        <td style="font-family: monospace;">${item.period}</td>
                        <td>${item.date}</td>
                        <td style="font-family: monospace; color: var(--accent-cyan); font-weight:600;">${num}</td>
                        <td>${zhixuanCount}</td>
                        <td>${zhixuanAmt}</td>
                        <td>${z3Count}</td>
                        <td>${z3Amt}</td>
                        <td>${z6Count}</td>
                        <td>${z6Amt}</td>
                        <td>${sale}</td>
                        <td>${pdf}</td>
                    </tr>
                `);
            });

            state.fullTable.currentPage++;
            state.fullTable.loading = false;

            const loadedAll = state.fullTable.currentPage >= state.fullTable.totalPages;
            $('#loadMoreBtn').text(loadedAll ? 'å·²åŠ è½½å…¨éƒ¨' : 'åŠ è½½æ›´å¤š').prop('disabled', loadedAll);
        }

        // æ»‘åŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µï¼ˆç§»åŠ¨ç«¯å‹å¥½ï¼‰
        $('#fullTableContainer').on('scroll', function() {
            const $el = $(this);
            if ($el[0].scrollHeight - $el.scrollTop() - $el.outerHeight() < 120) {
                loadNextTablePage();
            }
        });

        // åŠ è½½æ›´å¤šæŒ‰é’®
        $('#loadMoreBtn').on('click', function() {
            loadNextTablePage();
        });

        /* ========== æ‰‹åŠ¨ç²˜è´´ä¸å¯¼å‡ºä¸ºå•æ–‡ä»¶ HTML çš„å·¥å…·å‡½æ•° ========== */
        function normalizeApiItem(item) {
            // æ”¯æŒ API åŸå§‹é¡¹æˆ–å·²æ ‡å‡†åŒ–çš„é¡¹
            const rawResult = item.lotteryDrawResult || item.rawResult || '';
            const compact = (rawResult || (item.number || '')).toString().replace(/\s+/g, '');

            const getPrizeInfo = (prizeList, levelName, groupKey) => {
                if (!prizeList || !Array.isArray(prizeList)) return { stakeCount: '0', stakeAmount: '0' };
                const prize = prizeList.find(p => p.prizeLevel === levelName || p.group === groupKey) || prizeList.find(p => p.group === groupKey) || {};
                return {
                    stakeCount: (prize.stakeCount !== undefined) ? String(prize.stakeCount) : (prize.stakeCount || '0'),
                    stakeAmount: (prize.stakeAmountFormat || prize.stakeAmount || prize.stakeAmount || '0')
                };
            };

            return {
                number: compact,
                rawResult: rawResult || compact.split('').join(' '),
                date: item.lotteryDrawTime || item.date || '',
                period: item.lotteryDrawNum || item.period || '',
                prizeZhixuan: getPrizeInfo(item.prizeLevelList || item.prizeLevelList || [], 'ç›´é€‰', '10'),
                prizeZuxuan3: getPrizeInfo(item.prizeLevelList || item.prizeLevelList || [], 'ç»„é€‰3', '20'),
                prizeZuxuan6: getPrizeInfo(item.prizeLevelList || item.prizeLevelList || [], 'ç»„é€‰6', '30'),
                totalSaleAmount: item.totalSaleAmount || item.totalSaleAmountFormat || item.totalSale || '-',
                drawPdfUrl: item.drawPdfUrl || item.pdf || '',
                lotteryNotice: item.lotteryNotice || 0
            };
        }

        function applyPastedData(saveAndDownload = false) {
            const raw = $('#pasteJson').val().trim();
            if (!raw) { showError('è¯·å…ˆç²˜è´´JSONæ•°æ®'); return; }

            let parsed = null;
            try {
                parsed = JSON.parse(raw);
            } catch (e) {
                showError('JSON è§£æå¤±è´¥ï¼š' + e.message);
                return;
            }

            let list = null;
            if (Array.isArray(parsed)) {
                list = parsed;
            } else if (parsed.value && Array.isArray(parsed.value.list)) {
                list = parsed.value.list;
            } else if (Array.isArray(parsed.list)) {
                list = parsed.list;
            } else if (parsed.data && Array.isArray(parsed.data.list)) {
                list = parsed.data.list;
            } else {
                showError('æ— æ³•è¯†åˆ« JSON ç»“æ„ï¼Œè¯·ç²˜è´´æ¥å£è¿”å›çš„å®Œæ•´ JSON æˆ–å…¶ä¸­çš„ list æ•°ç»„ã€‚');
                return;
            }

            const normalized = list.map(normalizeApiItem).filter(i => i && i.period && i.number);
            if (normalized.length === 0) {
                showError('æœªä»ç²˜è´´çš„æ•°æ®ä¸­è§£æåˆ°æœ‰æ•ˆè®°å½•');
                return;
            }

            // å†™å…¥ state å¹¶åˆ·æ–°ç•Œé¢
            state.historyNumbers = normalized.sort((a, b) => parseInt(b.period || 0) - parseInt(a.period || 0));
            renderHistoryList();
            renderStats();
            setupFullHistoryTable();
            $('#manualFetchFallback').hide();
            // å°è¯•ä¿å­˜åˆ° localStorageï¼Œä¾¿äºä¸‹æ¬¡æ‰“å¼€æ—¶æ¢å¤ï¼ˆè‹¥æµè§ˆå™¨å…è®¸ï¼‰
            try {
                localStorage.setItem('anti_crowd_history', JSON.stringify(state.historyNumbers));
                showError('å·²åº”ç”¨ç²˜è´´æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°ï¼ˆ' + normalized.length + ' æ¡ï¼‰');
            } catch (e) {
                showError('å·²åº”ç”¨ç²˜è´´æ•°æ®ï¼ˆ' + normalized.length + ' æ¡ï¼‰');
            }

            if (saveAndDownload) {
                generateSelfContainedHTML();
            }
        }

        function generateSelfContainedHTML() {
            // åœ¨å½“å‰é¡µé¢ HTML ä¸­æ³¨å…¥ PRELOADED_HISTORY æ•°æ®å¹¶ä½œä¸ºå•æ–‡ä»¶ä¸‹è½½
            try {
                const html = '<!doctype html>\n' + document.documentElement.outerHTML;
                const dataScript = `<script>window.PRELOADED_HISTORY = ${JSON.stringify(state.historyNumbers)};<\/script>`;
                const injected = html.replace('</body>', dataScript + '\n</body>');
                const blob = new Blob([injected], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const ts = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
                a.download = `anti-crowd-lottery_${ts}.html`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
                showError('å·²ç”Ÿæˆå•æ–‡ä»¶ HTMLï¼Œä¸‹è½½åº”å·²å¼€å§‹');
            } catch (e) {
                showError('ç”Ÿæˆæ–‡ä»¶å¤±è´¥ï¼š' + e.message);
            }
        }

        /**
         * æ¸²æŸ“ç”Ÿæˆç»“æœ
         */
        function renderResults(results) {
            if (results.length === 0) {
                showError('ç”Ÿæˆå¤±è´¥ï¼Œè¯·è°ƒæ•´å‚æ•°åé‡è¯•');
                return;
            }

            let html = '';
            results.forEach((item, index) => {
                html += `
                    <article class="result-card">
                        <p class="label">ç¬¬ ${index + 1} æ³¨</p>
                        <p class="number">${item.number}</p>
                        <div class="analysis">${item.analysis}</div>
                    </article>
                `;
            });

            $('#resultsGrid').html(html);
            $('#resultsSection').addClass('show');

            // æ˜¾ç¤ºéšæœºæ´å¯Ÿ
            const randomInsight = CONFIG.INSIGHTS[Math.floor(Math.random() * CONFIG.INSIGHTS.length)];
            $('#insightQuote').text(`"${randomInsight}"`);

            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            $('html, body').animate({
                scrollTop: $('#resultsSection').offset().top - 20
            }, 500);
        }

        // ========== äº‹ä»¶ç»‘å®š ==========

        $(document).ready(function() {
            // åˆå§‹åŒ–ï¼šåœ¨ init å‰å°è¯•è¯»å–æœ¬åœ°ä¿å­˜çš„ä»£ç†è®¾ç½®
            try {
                const savedProxy = localStorage.getItem('anti_crowd_proxy_endpoint');
                if (savedProxy && savedProxy.trim()) {
                    CONFIG.PROXY_ENDPOINT = savedProxy.trim();
                    try { $('#customProxy').val(CONFIG.PROXY_ENDPOINT); } catch(e){}
                    showError('æ£€æµ‹åˆ°å·²ä¿å­˜çš„ä»£ç†ï¼Œä¼˜å…ˆä½¿ç”¨è¯¥ä»£ç†è¿›è¡Œè¯·æ±‚');
                }
            } catch (e) { console.warn('è¯»å–æœ¬åœ°ä»£ç†å¤±è´¥', e); }

            // åˆå§‹åŒ–ï¼šåŠ è½½æ•°æ®
            async function init() {
                const ok = await fetchHistoryData(5, 100); // è·å–500æœŸæ•°æ®ï¼š5é¡µï¼Œæ¯é¡µ100æ¡
                renderHistoryList();
                renderHotspots();
                renderStats();
                if (ok) {
                    setupFullHistoryTable();
                }
            }

            init();

            // ç­–ç•¥å¡ç‰‡ç‚¹å‡»
            $('.strategy-card').on('click', function() {
                $('.strategy-card').removeClass('active');
                $(this).addClass('active');
                state.selectedStrategy = $(this).data('strategy');
            });

            // ç”ŸæˆæŒ‰é’®ç‚¹å‡»
            $('#generateBtn').on('click', async function() {
                const $btn = $(this);

                if (state.isLoading) return;
                state.isLoading = true;
                $btn.addClass('loading');

                // æ¨¡æ‹ŸçŸ­æš‚å»¶è¿Ÿï¼Œå¢å¼ºä½“éªŒ
                await new Promise(resolve => setTimeout(resolve, 800));

                const results = generateNumbers(state.selectedStrategy);
                renderResults(results);
                
                // ç”Ÿæˆæ•°æ®åˆ†ææŠ¥å‘Š
                generateAnalysisReport();

                state.isLoading = false;
                $btn.removeClass('loading');
            });

            // åˆ·æ–°æ•°æ®
            $('#refreshBtn').on('click', async function() {
                const $btn = $(this);
                $btn.text('åˆ·æ–°ä¸­...');

                const ok = await fetchHistoryData();
                if (!ok) {
                    // fetch å¤±è´¥æ—¶ï¼ŒfetchHistoryData ä¼šæ˜¾ç¤ºæ‰‹åŠ¨å›é€€æç¤ºï¼ˆè‹¥è¢«æ‹¦æˆªï¼‰ï¼Œæ­¤å¤„ä»…ç¡®ä¿ manual UI å¯è§
                    $('#manualFetchFallback').show();
                }

                renderHistoryList();
                renderStats();
                setupFullHistoryTable();

                // å½“æˆåŠŸè·å–åˆ°æ•°æ®åï¼Œæç¤ºç”¨æˆ·å¯ä»¥å°†æ•°æ®ä¿å­˜åˆ°å•æ–‡ä»¶ HTMLï¼ˆç”¨äºç¦»çº¿ä¿ç•™ï¼‰
                $('#exportBtn').prop('disabled', false).text('ä¿å­˜ä¸ºå•æ–‡ä»¶');

                $btn.text('åˆ·æ–°æ•°æ®');
            });

            // æ·»åŠ å·ç 
            $('#addNumberBtn').on('click', function() {
                const input = $('#newNumber').val().trim();

                if (!/^\d{3}$/.test(input)) {
                    showError('è¯·è¾“å…¥3ä½æ•°å­—å·ç ');
                    return;
                }

                // æ·»åŠ åˆ°å†å²è®°å½•å¼€å¤´
                state.historyNumbers.unshift({
                    number: input,
                    rawResult: input.split('').join(' '),
                    date: new Date().toISOString().split('T')[0],
                    period: 'æ‰‹åŠ¨æ·»åŠ ',
                    prizeZhixuan: { stakeCount: '0', stakeAmount: '0' },
                    prizeZuxuan3: { stakeCount: '0', stakeAmount: '0' },
                    prizeZuxuan6: { stakeCount: '0', stakeAmount: '0' },
                    totalSaleAmount: '-'
                });

                $('#newNumber').val('');
                renderHistoryList();
                renderStats();
                setupFullHistoryTable();
            });

            // å›è½¦æ·»åŠ å·ç 
            $('#newNumber').on('keypress', function(e) {
                if (e.which === 13) {
                    $('#addNumberBtn').click();
                }
            });

            // ç²˜è´´æ•°æ®åº”ç”¨/ç”Ÿæˆå•æ–‡ä»¶ HTML æŒ‰é’®
            $('#applyPastedBtn').on('click', function() {
                applyPastedData(false);
            });
            $('#applyAndSaveBtn').on('click', function() {
                applyPastedData(true);
            });
            $('#clearPastedBtn').on('click', function() {
                $('#pasteJson').val('');
            });

            // ===== æ–‡ä»¶å¯¼å…¥ ä¸ ä»£ç†è·å–æ”¯æŒï¼ˆæ›¿ä»£ curlï¼‰ =====
            function applyParsedJson(parsed, saveAndDownload = false) {
                let list = null;
                if (Array.isArray(parsed)) list = parsed;
                else if (parsed && parsed.value && Array.isArray(parsed.value.list)) list = parsed.value.list;
                else if (parsed && Array.isArray(parsed.list)) list = parsed.list;
                else if (parsed && parsed.data && Array.isArray(parsed.data.list)) list = parsed.data.list;
                else { showError('æ— æ³•è¯†åˆ« JSON ç»“æ„ï¼Œè¯·å¯¼å…¥æ¥å£è¿”å›çš„ JSON æˆ–å…¶ä¸­çš„ list æ•°ç»„ã€‚'); return; }

                const normalized = list.map(normalizeApiItem).filter(i => i && i.period && i.number);
                if (normalized.length === 0) { showError('æœªä»æ•°æ®ä¸­è§£æåˆ°æœ‰æ•ˆè®°å½•'); return; }

                state.historyNumbers = normalized.sort((a, b) => parseInt(b.period || 0) - parseInt(a.period || 0));
                renderHistoryList();
                renderStats();
                setupFullHistoryTable();
                $('#manualFetchFallback').hide();

                try {
                    localStorage.setItem('anti_crowd_history', JSON.stringify(state.historyNumbers));
                    showError('å·²å¯¼å…¥æ•°æ®å¹¶ä¿å­˜åˆ°æœ¬åœ°ï¼ˆ' + normalized.length + ' æ¡ï¼‰');
                } catch (e) {
                    showError('å·²åº”ç”¨æ•°æ®ï¼ˆ' + normalized.length + ' æ¡ï¼‰');
                }

                if (saveAndDownload) {
                    generateSelfContainedHTML();
                }
            }

            // å¯¼å…¥æ–‡ä»¶æŒ‰é’®
            $('#applyFileBtn').on('click', function() {
                const file = ($('#importFile')[0] && $('#importFile')[0].files && $('#importFile')[0].files[0]) || null;
                if (!file) { showError('è¯·é€‰æ‹© JSON æ–‡ä»¶åå†å¯¼å…¥'); return; }
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const parsed = JSON.parse(e.target.result);
                        applyParsedJson(parsed, false);
                    } catch (err) {
                        showError('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + (err && err.message ? err.message : err));
                    }
                };
                reader.onerror = function() { showError('è¯»å–æ–‡ä»¶å¤±è´¥'); };
                reader.readAsText(file, 'utf-8');
            });

            // æ–‡ä»¶é€‰æ‹©æ—¶ä¸è‡ªåŠ¨æäº¤ï¼Œåªåšæç¤ºï¼ˆç”¨æˆ·ç‚¹å‡»å¯¼å…¥æŒ‰é’®ä¿¡ä»»ï¼‰
            $('#importFile').on('change', function() {
                if (this.files && this.files.length) {
                    showError('å·²é€‰æ‹©æ–‡ä»¶ï¼Œç‚¹å‡»â€œå¯¼å…¥å¹¶åº”ç”¨â€å¼€å§‹å¯¼å…¥');
                }
            });

            // ç»Ÿä¸€çš„ä»£ç†å°è¯•å‡½æ•°ï¼šå°è¯•å¤šä¸ªä»£ç†å¹¶åœ¨æˆåŠŸæ—¶åº”ç”¨è§£æç»“æœ
            async function attemptProxiesAndApply(proxies, target) {
                let lastErr = null;
                for (const p of proxies) {
                    try {
                        const prefix = p;
                        const url = prefix + encodeURIComponent(target);
                        const resp = await fetch(url, { method: 'GET' });
                        if (!resp.ok) throw new Error('http:' + resp.status);
                        let data = null;
                        try { data = await resp.json(); }
                        catch (e) {
                            const text = await resp.text();
                            const maybe = text.replace(/^[^(]*\((([\s\S]*)?)\);?$/, '$1');
                            data = JSON.parse(maybe);
                        }
                        applyParsedJson(data, false);
                        return true;
                    } catch (e) {
                        lastErr = e;
                        console.warn('proxy fetch failed', p, e);
                        continue;
                    }
                }
                console.warn('all proxies failed', lastErr);
                return false;
            }

            // é€šè¿‡å…¬ç”¨ CORS ä»£ç†å°è¯•è·å–ï¼ˆç”¨æˆ·å¯æ‰‹åŠ¨è§¦å‘ï¼‰
            $('#tryProxyFetchBtn').on('click', async function() {
                const $btn = $(this);
                $btn.prop('disabled', true).text('å°è¯•ä¸­...');
                const target = (CONFIG.API_URL || '').replace(/callback=\?/, '');
                const custom = ($('#customProxy').val() || '').trim();
                const proxies = [];
                if (custom) proxies.push(custom);
                proxies.push('https://api.allorigins.win/raw?url=');
                proxies.push('https://thingproxy.freeboard.io/fetch/');

                const ok = await attemptProxiesAndApply(proxies, target);
                if (!ok) showError('é€šè¿‡ä»£ç†è·å–å¤±è´¥ï¼Œè¯·å°è¯•æ›´æ¢è‡ªå®šä¹‰ä»£ç†æˆ–æ‰‹åŠ¨å¯¼å…¥ JSON');
                $btn.prop('disabled', false).text('é€šè¿‡ä»£ç†å°è¯•è·å–');
            });

            // å¤åˆ¶ Cloudflare Worker ç¤ºä¾‹ä»£ç åˆ°å‰ªè´´æ¿
            $('#copyWorkerBtn').on('click', async function() {
                const txt = $('#workerCode').text();
                try {
                    await navigator.clipboard.writeText(txt);
                    showError('å·²å¤åˆ¶ Worker ç¤ºä¾‹ä»£ç åˆ°å‰ªè´´æ¿');
                } catch (e) {
                    try {
                        const ta = document.createElement('textarea');
                        ta.value = txt;
                        document.body.appendChild(ta);
                        ta.select();
                        document.execCommand('copy');
                        ta.remove();
                        showError('å·²å¤åˆ¶ç¤ºä¾‹ä»£ç ï¼ˆå¤‡ç”¨æ–¹æ³•ï¼‰');
                    } catch (ee) {
                        showError('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                    }
                }
            });

            // æ˜¾ç¤º wrangler éƒ¨ç½²ç¤ºä¾‹
            $('#showWranglerBtn').on('click', function() {
                $('#wranglerExample').toggle();
            });

            // ä¿å­˜ä»£ç†ä¸ºå…¨å±€å¹¶æµ‹è¯•ï¼ˆä¿å­˜åˆ° localStorage å¹¶å†™å…¥ CONFIGï¼‰
            $('#saveProxyBtn').on('click', async function() {
                const val = ($('#customProxy').val() || '').trim();
                if (!val) { showError('è¯·è¾“å…¥ä»£ç† URL'); return; }
                try {
                    localStorage.setItem('anti_crowd_proxy_endpoint', val);
                    CONFIG.PROXY_ENDPOINT = val;
                    showError('å·²ä¿å­˜ä»£ç†ä¸ºå…¨å±€ï¼Œæ­£åœ¨æµ‹è¯•å¹¶å°è¯•æ‹‰å–æ•°æ®...');
                    const target = (CONFIG.API_URL || '').replace(/callback=\?/, '');
                    const ok = await attemptProxiesAndApply([val], target);
                    if (ok) showError('ä»£ç†æµ‹è¯•æˆåŠŸå¹¶å·²åº”ç”¨æ•°æ®');
                    else showError('ä»£ç†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Worker æ˜¯å¦å¯è®¿é—®æˆ–è¿”å›äº†æ­£ç¡®çš„ JSON');
                } catch (e) {
                    showError('ä¿å­˜æˆ–æµ‹è¯•ä»£ç†æ—¶å‘ç”Ÿé”™è¯¯ï¼š' + (e && e.message ? e.message : e));
                }
            });

            // æµ‹è¯•ä»£ç†ä½†ä¸ä¿å­˜
            $('#testProxyBtn').on('click', async function() {
                const $btn = $(this);
                $btn.prop('disabled', true).text('æµ‹è¯•ä¸­...');
                const val = ($('#customProxy').val() || '').trim();
                if (!val) { showError('è¯·è¾“å…¥ä»£ç† URL'); $btn.prop('disabled', false).text('æµ‹è¯•ä»£ç†'); return; }
                try {
                    const target = (CONFIG.API_URL || '').replace(/callback=\?/, '');
                    const ok = await attemptProxiesAndApply([val], target);
                    if (ok) showError('ä»£ç†æµ‹è¯•æˆåŠŸå¹¶å·²åº”ç”¨æ•°æ®');
                    else showError('ä»£ç†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä»£ç†å¯ç”¨æ€§');
                } catch (e) {
                    showError('æµ‹è¯•ä»£ç†æ—¶å‘ç”Ÿé”™è¯¯ï¼š' + (e && e.message ? e.message : e));
                } finally {
                    $btn.prop('disabled', false).text('æµ‹è¯•ä»£ç†');
                }
            });





            // åˆ é™¤å†å²å·ç 
            $('#historyList').on('click', '.delete-btn', function(e) {
                e.stopPropagation();
                const index = $(this).data('index');
                state.historyNumbers.splice(index, 1);
                renderHistoryList();
                renderStats();
                setupFullHistoryTable();
            });

            // é¿å¼€æœŸæ•°å˜åŒ–
            $('#avoidPeriods').on('change', function() {
                renderStats();
            });
        });
    </script>
</body>
</html>
